- [前言](#前言)
- [变量提升](#变量提升)
- [关于作用域、变量提升、函数表达式、立即函数表达式的经典面试题](#关于作用域变量提升函数表达式立即函数表达式的经典面试题)

## 前言
网页的工作过程需要使用到两个引擎渲染引擎和JavaScript引擎。它们分别负责不同的事情：JavaScript引擎负责执行JavaScript代码，而渲染引擎负责渲染网页。

JavaScript引擎提供调用接口被渲染引擎使用，渲染引擎使用JavaScript引擎来处理JavaScript代码并获取结果。

JS引擎，简单来说就是能够提供执行JavaScript代码的运行环境。

JS的引擎包括：**Google V8、JavaScriptCore**等，其中Google V8是主流浏览器的选择。因此，本文学习的变量提升、如何执行代码、内存管理，垃圾回收，甚至JS事件回收机制都是基于Google V8引擎展开的

> 参考文章：[什么是JS引擎](https://www.jianshu.com/p/565dfad8d41e)

## 变量提升
在 V8 解析 JavaScript 源码的过程中，如果遇到普通的变量声明，那么便会将其提升到作用域中，并给该变量赋值为 undefined，如果遇到的是函数声明，那么 V8 会在内存中为声明生成函数对象，并将该对象提升到作用域中。
```js
console.log(x) // undefined
console.log(foo) // 打印完整对象 ƒ foo(){}

var x = 5
function foo(){
}
```
## 关于作用域、变量提升、函数表达式、立即函数表达式的经典面试题
```js
var n = 1;
(function foo(){
    n = 100;
    console.log(n); // 100
}())
console.log(n); // 100
```
原因：
1. 编译阶段，先在全局作用域内声明变量 n 的值为`undefined`，然后声明函数表达式；编译阶段结束。
2. 开始执行阶段，将 1 赋值给 n，函数表达式**立即执行**，欲将 100 赋值给变量 n，但在当前作用域内没有找到 n 的声明，沿着作用域链向上查找，在**全局作用域**内找到了变量 n，将 100 赋给它，接着执行立即函数调用表达式中的打印语句，输出 n，为100。
3. 接着执行后面的打印语句，此时 n 的值已经由 1 被修改为了 100，因此输出 100

```js
var n = 1;
function foo(){
    n = 100;
    console.log(n);
}
console.log(n); // 1
foo() // 100
```
原因：
1. 第一次打印的时候，函数只是被放入作用域，函数没有执行，输出的是全局作用域中声明并赋值好的1；
2. 然后函数执行，将**全局作用域**中的 n 修改为 100，因此输出 100。