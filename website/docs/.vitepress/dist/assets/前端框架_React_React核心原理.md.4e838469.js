import{_ as e,o as s,c as a,d as n}from"./app.8cb9dc40.js";const l="/assets/reactRender.cb228ac9.png",o="/assets/beginWork.7b9f4e1d.png",c="/assets/completeWork.4557c553.png",f=JSON.parse('{"title":"Reactç†å¿µ","description":"","frontmatter":{},"headers":[{"level":2,"title":"Reactç†å¿µ","slug":"reactç†å¿µ-1","link":"#reactç†å¿µ-1","children":[]},{"level":2,"title":"è€Reactæ¶æ„ - React 15","slug":"è€reactæ¶æ„-react-15","link":"#è€reactæ¶æ„-react-15","children":[{"level":3,"title":"Reconcilerï¼ˆåè°ƒå™¨ï¼‰","slug":"reconciler-åè°ƒå™¨","link":"#reconciler-åè°ƒå™¨","children":[]},{"level":3,"title":"Rendererï¼ˆæ¸²æŸ“å™¨ï¼‰","slug":"renderer-æ¸²æŸ“å™¨","link":"#renderer-æ¸²æŸ“å™¨","children":[]},{"level":3,"title":"React15çš„ç¼ºç‚¹","slug":"react15çš„ç¼ºç‚¹","link":"#react15çš„ç¼ºç‚¹","children":[]}]},{"level":2,"title":"æ–°Reactæ¶æ„ - React16","slug":"æ–°reactæ¶æ„-react16","link":"#æ–°reactæ¶æ„-react16","children":[{"level":3,"title":"Schedulerï¼ˆè°ƒåº¦å™¨ï¼‰","slug":"scheduler-è°ƒåº¦å™¨","link":"#scheduler-è°ƒåº¦å™¨","children":[]},{"level":3,"title":"Reconcilerï¼ˆåè°ƒå™¨ï¼‰ps:renderé˜¶æ®µ","slug":"reconciler-åè°ƒå™¨-ps-renderé˜¶æ®µ","link":"#reconciler-åè°ƒå™¨-ps-renderé˜¶æ®µ","children":[]},{"level":3,"title":"Renderï¼ˆæ¸²æŸ“å™¨ï¼‰ps:commité˜¶æ®µ","slug":"render-æ¸²æŸ“å™¨-ps-commité˜¶æ®µ","link":"#render-æ¸²æŸ“å™¨-ps-commité˜¶æ®µ","children":[]},{"level":3,"title":"æ€»ç»“ â—","slug":"æ€»ç»“","link":"#æ€»ç»“","children":[]}]},{"level":2,"title":"Fiber","slug":"fiber","link":"#fiber","children":[{"level":3,"title":"Fiberæ¶æ„ - å¿ƒæ™ºæ¨¡å¼","slug":"fiberæ¶æ„-å¿ƒæ™ºæ¨¡å¼","link":"#fiberæ¶æ„-å¿ƒæ™ºæ¨¡å¼","children":[]},{"level":3,"title":"Fiberæ¶æ„çš„å®ç°åŸç†","slug":"fiberæ¶æ„çš„å®ç°åŸç†","link":"#fiberæ¶æ„çš„å®ç°åŸç†","children":[]},{"level":3,"title":"Fiberæ¶æ„çš„å·¥ä½œåŸç† - åŒç¼“å­˜ â—","slug":"fiberæ¶æ„çš„å·¥ä½œåŸç†-åŒç¼“å­˜","link":"#fiberæ¶æ„çš„å·¥ä½œåŸç†-åŒç¼“å­˜","children":[]}]},{"level":2,"title":"ä¸“ä¸šæœ¯è¯­è§£é‡Šï¼Œ renderé˜¶æ®µã€commité˜¶æ®µç­‰ä¸æ€»ç»“ â—","slug":"ä¸“ä¸šæœ¯è¯­è§£é‡Š-renderé˜¶æ®µã€commité˜¶æ®µç­‰ä¸æ€»ç»“","link":"#ä¸“ä¸šæœ¯è¯­è§£é‡Š-renderé˜¶æ®µã€commité˜¶æ®µç­‰ä¸æ€»ç»“","children":[]},{"level":2,"title":"æµç¨‹æ¦‚è§ˆ","slug":"æµç¨‹æ¦‚è§ˆ","link":"#æµç¨‹æ¦‚è§ˆ","children":[{"level":3,"title":"â€œé€’â€é˜¶æ®µ","slug":"é€’-é˜¶æ®µ","link":"#é€’-é˜¶æ®µ","children":[]},{"level":3,"title":"â€œå½’â€é˜¶æ®µ","slug":"å½’-é˜¶æ®µ","link":"#å½’-é˜¶æ®µ","children":[]},{"level":3,"title":"ä¾‹å­","slug":"ä¾‹å­","link":"#ä¾‹å­","children":[]}]},{"level":2,"title":"â€œé€’â€é˜¶æ®µ - beginWork","slug":"é€’-é˜¶æ®µ-beginwork","link":"#é€’-é˜¶æ®µ-beginwork","children":[]},{"level":2,"title":"\\"å½’\\"é˜¶æ®µ - completeWork","slug":"å½’-é˜¶æ®µ-completework","link":"#å½’-é˜¶æ®µ-completework","children":[]},{"level":2,"title":"before mutationé˜¶æ®µï¼ˆæ‰§è¡ŒDOMæ“ä½œå‰ï¼‰","slug":"before-mutationé˜¶æ®µ-æ‰§è¡Œdomæ“ä½œå‰","link":"#before-mutationé˜¶æ®µ-æ‰§è¡Œdomæ“ä½œå‰","children":[]},{"level":2,"title":"mutationé˜¶æ®µï¼ˆæ‰§è¡ŒDOMæ“ä½œï¼‰","slug":"mutationé˜¶æ®µ-æ‰§è¡Œdomæ“ä½œ","link":"#mutationé˜¶æ®µ-æ‰§è¡Œdomæ“ä½œ","children":[]},{"level":2,"title":"layouté˜¶æ®µï¼ˆæ‰§è¡ŒDOMæ“ä½œåï¼‰","slug":"layouté˜¶æ®µ-æ‰§è¡Œdomæ“ä½œå","link":"#layouté˜¶æ®µ-æ‰§è¡Œdomæ“ä½œå","children":[]}],"relativePath":"å‰ç«¯æ¡†æ¶/React/Reactæ ¸å¿ƒåŸç†.md"}'),r={name:"å‰ç«¯æ¡†æ¶/React/Reactæ ¸å¿ƒåŸç†.md"},t=n(`<ul><li><a href="#react%E7%90%86%E5%BF%B5">Reactç†å¿µ</a><ul><li><a href="#react%E7%90%86%E5%BF%B5-1">Reactç†å¿µ</a></li><li><a href="#%E8%80%81react%E6%9E%B6%E6%9E%84---react-15">è€Reactæ¶æ„ - React 15</a><ul><li><a href="#reconciler%E5%8D%8F%E8%B0%83%E5%99%A8">Reconcilerï¼ˆåè°ƒå™¨ï¼‰</a></li><li><a href="#renderer%E6%B8%B2%E6%9F%93%E5%99%A8">Rendererï¼ˆæ¸²æŸ“å™¨ï¼‰</a></li><li><a href="#react15%E7%9A%84%E7%BC%BA%E7%82%B9">React15çš„ç¼ºç‚¹</a></li></ul></li><li><a href="#%E6%96%B0react%E6%9E%B6%E6%9E%84---react16">æ–°Reactæ¶æ„ - React16</a><ul><li><a href="#scheduler%E8%B0%83%E5%BA%A6%E5%99%A8">Schedulerï¼ˆè°ƒåº¦å™¨ï¼‰</a></li><li><a href="#reconciler%E5%8D%8F%E8%B0%83%E5%99%A8psrender%E9%98%B6%E6%AE%B5">Reconcilerï¼ˆåè°ƒå™¨ï¼‰ps:renderé˜¶æ®µ</a></li><li><a href="#render%E6%B8%B2%E6%9F%93%E5%99%A8pscommit%E9%98%B6%E6%AE%B5">Renderï¼ˆæ¸²æŸ“å™¨ï¼‰ps:commité˜¶æ®µ</a></li><li><a href="#%E6%80%BB%E7%BB%93-heavy_exclamation_mark">æ€»ç»“ :heavy_exclamation_mark:</a></li></ul></li><li><a href="#fiber">Fiber</a><ul><li><a href="#fiber%E6%9E%B6%E6%9E%84---%E5%BF%83%E6%99%BA%E6%A8%A1%E5%BC%8F">Fiberæ¶æ„ - å¿ƒæ™ºæ¨¡å¼</a><ul><li><a href="#%E4%BB%80%E4%B9%88%E6%98%AF%E4%BB%A3%E6%95%B0%E6%95%88%E5%BA%94">ä»€ä¹ˆæ˜¯ä»£æ•°æ•ˆåº”</a></li><li><a href="#%E4%BB%A3%E6%95%B0%E6%95%88%E5%BA%94%E5%9C%A8react%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8---hooks">ä»£æ•°æ•ˆåº”åœ¨Reactä¸­çš„åº”ç”¨ - <code>Hooks</code></a></li><li><a href="#%E4%BB%A3%E6%95%B0%E6%95%88%E5%BA%94%E5%92%8Cfiber">ä»£æ•°æ•ˆåº”å’ŒFiber</a></li></ul></li><li><a href="#fiber%E6%9E%B6%E6%9E%84%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86">Fiberæ¶æ„çš„å®ç°åŸç†</a></li><li><a href="#fiber%E6%9E%B6%E6%9E%84%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86---%E5%8F%8C%E7%BC%93%E5%AD%98-heavy_exclamation_mark">Fiberæ¶æ„çš„å·¥ä½œåŸç† - åŒç¼“å­˜ :heavy_exclamation_mark:</a></li></ul></li><li><a href="#%E4%B8%93%E4%B8%9A%E6%9C%AF%E8%AF%AD%E8%A7%A3%E9%87%8A-render%E9%98%B6%E6%AE%B5commit%E9%98%B6%E6%AE%B5%E7%AD%89%E4%B8%8E%E6%80%BB%E7%BB%93-heavy_exclamation_mark">ä¸“ä¸šæœ¯è¯­è§£é‡Šï¼Œ renderé˜¶æ®µã€commité˜¶æ®µç­‰ä¸æ€»ç»“ :heavy_exclamation_mark:</a></li></ul></li><li><a href="#render%E9%98%B6%E6%AE%B5-heavy_exclamation_mark">Renderé˜¶æ®µ :heavy_exclamation_mark:</a><ul><li><a href="#%E6%B5%81%E7%A8%8B%E6%A6%82%E8%A7%88">æµç¨‹æ¦‚è§ˆ</a><ul><li><a href="#%E9%80%92%E9%98%B6%E6%AE%B5">â€œé€’â€é˜¶æ®µ</a></li><li><a href="#%E5%BD%92%E9%98%B6%E6%AE%B5">â€œå½’â€é˜¶æ®µ</a></li><li><a href="#%E4%BE%8B%E5%AD%90">ä¾‹å­</a></li></ul></li><li><a href="#%E9%80%92%E9%98%B6%E6%AE%B5---beginwork">â€œé€’â€é˜¶æ®µ - beginWork</a></li><li><a href="#%E5%BD%92%E9%98%B6%E6%AE%B5---completework">&quot;å½’&quot;é˜¶æ®µ - completeWork</a></li></ul></li><li><a href="#commit%E9%98%B6%E6%AE%B5">commité˜¶æ®µ</a><ul><li><a href="#before-mutation%E9%98%B6%E6%AE%B5%E6%89%A7%E8%A1%8Cdom%E6%93%8D%E4%BD%9C%E5%89%8D">before mutationé˜¶æ®µï¼ˆæ‰§è¡ŒDOMæ“ä½œå‰ï¼‰</a></li><li><a href="#mutation%E9%98%B6%E6%AE%B5%E6%89%A7%E8%A1%8Cdom%E6%93%8D%E4%BD%9C">mutationé˜¶æ®µï¼ˆæ‰§è¡ŒDOMæ“ä½œï¼‰</a></li><li><a href="#layout%E9%98%B6%E6%AE%B5%E6%89%A7%E8%A1%8Cdom%E6%93%8D%E4%BD%9C%E5%90%8E">layouté˜¶æ®µï¼ˆæ‰§è¡ŒDOMæ“ä½œåï¼‰</a></li></ul></li><li><a href="#diff%E7%AE%97%E6%B3%95">Diffç®—æ³•</a></li></ul><blockquote><p>å‚è€ƒèµ„æ–™ï¼šReactæŠ€æœ¯æ­ç§˜ï¼š<a href="https://react.iamkasong.com/preparation/idea.html#react%E7%90%86%E5%BF%B5" target="_blank" rel="noreferrer">https://react.iamkasong.com/preparation/idea.html#reactç†å¿µ</a></p></blockquote><h1 id="reactç†å¿µ" tabindex="-1">Reactç†å¿µ <a class="header-anchor" href="#reactç†å¿µ" aria-hidden="true">#</a></h1><h2 id="reactç†å¿µ-1" tabindex="-1">Reactç†å¿µ <a class="header-anchor" href="#reactç†å¿µ-1" aria-hidden="true">#</a></h2><p>Reactç†å¿µæ˜¯ï¼šæ„å»ºå¿«é€Ÿå“åº”çš„å¤§å‹ Web åº”ç”¨ç¨‹åºã€‚</p><p>ä½†ç”±äºä»¥ä¸‹ä¸¤ä¸ªç“¶é¢ˆä¼šåˆ¶çº¦åº”ç”¨çš„å“åº”é€Ÿåº¦ï¼š</p><ol><li>CPUç“¶é¢ˆï¼šå½“é‡åˆ°å¤§è®¡ç®—é‡çš„æ“ä½œæˆ–è€…è®¾å¤‡æ€§èƒ½ä¸è¶³ä½¿é¡µé¢æ‰å¸§ï¼Œå¯¼è‡´å¡é¡¿ã€‚</li><li>IOç“¶é¢ˆï¼šå‘é€ç½‘ç»œè¯·æ±‚åï¼Œç”±äºéœ€è¦ç­‰å¾…æ•°æ®è¿”å›æ‰èƒ½è¿›ä¸€æ­¥æ“ä½œå¯¼è‡´ä¸èƒ½å¿«é€Ÿå“åº”ã€‚</li></ol><p>Reactåº”å¯¹è¿™ä¸¤å¤§ç“¶é¢ˆçš„åŠæ³•æ˜¯ï¼šåŠªåŠ›å°†<code>åŒæ­¥</code>çš„æ›´æ–°å˜ä¸º<code>å¯ä¸­æ–­</code>çš„å¼‚æ­¥æ›´æ–°ã€‚â¤ï¸</p><h2 id="è€reactæ¶æ„-react-15" tabindex="-1">è€Reactæ¶æ„ - React 15 <a class="header-anchor" href="#è€reactæ¶æ„-react-15" aria-hidden="true">#</a></h2><p>React15æ¶æ„å¯ä»¥åˆ†ä¸ºä¸¤å±‚ï¼š</p><ul><li><code>Reconcilerï¼ˆåè°ƒå™¨ï¼‰</code>â€”â€” è´Ÿè´£æ‰¾å‡ºå˜åŒ–çš„ç»„ä»¶</li><li><code>Rendererï¼ˆæ¸²æŸ“å™¨ï¼‰</code>â€”â€” è´Ÿè´£å°†å˜åŒ–çš„ç»„ä»¶æ¸²æŸ“åˆ°é¡µé¢ä¸Š</li></ul><h3 id="reconciler-åè°ƒå™¨" tabindex="-1">Reconcilerï¼ˆåè°ƒå™¨ï¼‰ <a class="header-anchor" href="#reconciler-åè°ƒå™¨" aria-hidden="true">#</a></h3><p>æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨Reactä¸­å¯ä»¥é€šè¿‡this.setStateã€this.forceUpdateã€ReactDOM.renderç­‰APIè§¦å‘æ›´æ–°ã€‚</p><p>æ¯å½“æœ‰æ›´æ–°å‘ç”Ÿæ—¶ï¼ŒReconcilerä¼šåšå¦‚ä¸‹å·¥ä½œï¼š</p><ol><li>è°ƒç”¨å‡½æ•°ç»„ä»¶ã€æˆ–classç»„ä»¶çš„renderæ–¹æ³•ï¼Œå°†è¿”å›çš„JSXè½¬åŒ–ä¸ºè™šæ‹ŸDOM</li><li>å°†è™šæ‹ŸDOMå’Œä¸Šæ¬¡æ›´æ–°æ—¶çš„è™šæ‹ŸDOMå¯¹æ¯”</li><li>é€šè¿‡å¯¹æ¯”æ‰¾å‡ºæœ¬æ¬¡æ›´æ–°ä¸­å˜åŒ–çš„è™šæ‹ŸDOM</li><li>é€šçŸ¥<code>Renderer</code>å°†å˜åŒ–çš„è™šæ‹ŸDOMæ¸²æŸ“åˆ°é¡µé¢ä¸Š</li></ol><p>Reconcileræ˜¯é€’å½’å¤„ç†è™šæ‹ŸDOMçš„ï¼Œ<a href="https://zh-hans.reactjs.org/docs/implementation-notes.html" target="_blank" rel="noreferrer">å‚è€ƒé“¾æ¥</a></p><h3 id="renderer-æ¸²æŸ“å™¨" tabindex="-1">Rendererï¼ˆæ¸²æŸ“å™¨ï¼‰ <a class="header-anchor" href="#renderer-æ¸²æŸ“å™¨" aria-hidden="true">#</a></h3><p>ç”±äºReactæ”¯æŒè·¨å¹³å°ï¼Œæ‰€ä»¥ä¸åŒå¹³å°æœ‰ä¸åŒçš„Rendererã€‚æˆ‘ä»¬å‰ç«¯æœ€ç†Ÿæ‚‰çš„æ˜¯è´Ÿè´£åœ¨<code>æµè§ˆå™¨</code>ç¯å¢ƒæ¸²æŸ“çš„Renderer â€”â€” <a href="https://www.npmjs.com/package/react-dom" target="_blank" rel="noreferrer">ReactDOM</a>ã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä»¥ä¸‹å‡ ç§renderï¼š</p><ol><li>ReactNativeæ¸²æŸ“å™¨ï¼Œæ¸²æŸ“AppåŸç”Ÿç»„ä»¶</li><li>ReactTestæ¸²æŸ“å™¨ï¼Œæ¸²æŸ“å‡ºçº¯Jså¯¹è±¡ç”¨äºæµ‹è¯•</li><li>ReactArtæ¸²æŸ“å™¨ï¼Œæ¸²æŸ“åˆ°Canvas, SVG æˆ– VML (IE8)</li></ol><p>åœ¨æ¯æ¬¡æ›´æ–°å‘ç”Ÿæ—¶ï¼Œ<code>Renderer</code>æ¥åˆ°<code>Reconciler</code>é€šçŸ¥ï¼Œå°†å˜åŒ–çš„ç»„ä»¶æ¸²æŸ“åœ¨å½“å‰å®¿ä¸»ç¯å¢ƒã€‚</p><h3 id="react15çš„ç¼ºç‚¹" tabindex="-1">React15çš„ç¼ºç‚¹ <a class="header-anchor" href="#react15çš„ç¼ºç‚¹" aria-hidden="true">#</a></h3><p>å½“å­ç»„ä»¶æ›´æ–°ä¸€æ—¦å¼€å§‹ï¼Œä¸­é€”å°±æ— æ³•ä¸­æ–­ã€‚å½“å±‚çº§å¾ˆæ·±æ—¶ï¼Œé€’å½’æ›´æ–°æ—¶é—´è¶…è¿‡äº†16msï¼Œç”¨æˆ·äº¤äº’å°±ä¼šå¡é¡¿ã€‚</p><h2 id="æ–°reactæ¶æ„-react16" tabindex="-1">æ–°Reactæ¶æ„ - React16 <a class="header-anchor" href="#æ–°reactæ¶æ„-react16" aria-hidden="true">#</a></h2><p>React16æ¶æ„å¯ä»¥åˆ†ä¸ºä¸‰å±‚ï¼š</p><ul><li><code>Schedulerï¼ˆè°ƒåº¦å™¨ï¼‰</code>â€”â€” è°ƒåº¦ä»»åŠ¡çš„ä¼˜å…ˆçº§ï¼Œé«˜ä¼˜ä»»åŠ¡ä¼˜å…ˆè¿›å…¥Reconcilerã€‚ğŸ“Œ</li><li><code>Reconcilerï¼ˆåè°ƒå™¨ï¼‰</code>â€”â€” è´Ÿè´£æ‰¾å‡ºå˜åŒ–çš„ç»„ä»¶ ğŸ“Œ</li><li><code>Rendererï¼ˆæ¸²æŸ“å™¨ï¼‰</code>â€”â€” è´Ÿè´£å°†å˜åŒ–çš„ç»„ä»¶æ¸²æŸ“åˆ°é¡µé¢ä¸Š</li></ul><p><strong>å¯ä»¥çœ‹åˆ°ï¼Œç›¸è¾ƒäºReact15ï¼ŒReact16ä¸­æ–°å¢äº†Schedulerï¼ˆè°ƒåº¦å™¨ï¼‰ï¼Œè®©æˆ‘ä»¬æ¥äº†è§£ä¸‹ä»–ã€‚</strong></p><h3 id="scheduler-è°ƒåº¦å™¨" tabindex="-1">Schedulerï¼ˆè°ƒåº¦å™¨ï¼‰ <a class="header-anchor" href="#scheduler-è°ƒåº¦å™¨" aria-hidden="true">#</a></h3><p>Reactå®ç°äº†åŠŸèƒ½æ›´å®Œå¤‡çš„<code>requestIdleCallback</code>polyfillï¼Œè¿™å°±æ˜¯<code>Scheduler</code>ã€‚ä¼šåœ¨æµè§ˆå™¨ç©ºé—²æ—¶è§¦å‘å›è°ƒçš„åŠŸèƒ½å¤–ï¼ŒSchedulerè¿˜æä¾›äº†å¤šç§è°ƒåº¦ä¼˜å…ˆçº§ä¾›ä»»åŠ¡è®¾ç½®ã€‚</p><blockquote><p>éƒ¨åˆ†æµè§ˆå™¨å·²ç»å®ç°äº†<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/requestIdleCallback" target="_blank" rel="noreferrer">requestIdleCallback</a>è¿™ä¸ªAPIï¼Œä½†å­˜åœ¨å…¼å®¹æ€§é—®é¢˜ï¼›å¹¶ä¸”è¯¥æ–¹æ³•çš„è§¦å‘å—å¾ˆå¤šå› ç´ å½±å“ï¼Œæ‰€ä»¥ä¸ç¨³å®šã€‚ Scheduleræ˜¯ç‹¬ç«‹äºReactçš„åº“</p></blockquote><h3 id="reconciler-åè°ƒå™¨-ps-renderé˜¶æ®µ" tabindex="-1">Reconcilerï¼ˆåè°ƒå™¨ï¼‰ps:renderé˜¶æ®µ <a class="header-anchor" href="#reconciler-åè°ƒå™¨-ps-renderé˜¶æ®µ" aria-hidden="true">#</a></h3><p>åœ¨React15ä¸­Reconcileræ˜¯é€’å½’å¤„ç†è™šæ‹ŸDOMçš„ã€‚åœ¨React16ä¸­ï¼Œæ›´æ–°å·¥ä½œä»é€’å½’å˜æˆäº†å¯ä»¥<code>ä¸­æ–­</code>çš„<code>å¾ªç¯</code>è¿‡ç¨‹ã€‚æ¯æ¬¡å¾ªç¯éƒ½ä¼šè°ƒç”¨<code>shouldYield</code>åˆ¤æ–­å½“å‰æ˜¯å¦æœ‰å‰©ä½™æ—¶é—´ã€‚</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">workLoopConcurrent</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// Perform work until Scheduler asks us to yield</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">while</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">workInProgress</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!==</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!</span><span style="color:#82AAFF;">shouldYield</span><span style="color:#F07178;">()) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">workInProgress</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">performUnitOfWork</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">workInProgress</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>é‚£ä¹ˆReact16æ˜¯å¦‚ä½•è§£å†³ä¸­æ–­æ›´æ–°æ—¶DOMæ¸²æŸ“ä¸å®Œå…¨çš„é—®é¢˜å‘¢ï¼Ÿ</p><ul><li>åœ¨React16ä¸­ï¼ŒReconcilerä¸Rendererä¸å†æ˜¯äº¤æ›¿å·¥ä½œã€‚å½“Schedulerå°†ä»»åŠ¡äº¤ç»™Reconcileråï¼ŒReconcilerä¼šä¸ºå˜åŒ–çš„è™šæ‹ŸDOMæ‰“ä¸Šä»£è¡¨<code>å¢/åˆ /æ›´æ–°</code>çš„æ ‡è®°</li><li>æ•´ä¸ªSchedulerä¸Reconcilerçš„å·¥ä½œéƒ½åœ¨å†…å­˜ä¸­è¿›è¡Œã€‚åªæœ‰å½“æ‰€æœ‰ç»„ä»¶éƒ½å®ŒæˆReconcilerçš„å·¥ä½œï¼Œæ‰ä¼šç»Ÿä¸€äº¤ç»™Rendererã€‚</li></ul><p>Reconcilerå†…éƒ¨é‡‡ç”¨äº†<code>Fiber</code>çš„æ¶æ„ã€‚â—</p><h3 id="render-æ¸²æŸ“å™¨-ps-commité˜¶æ®µ" tabindex="-1">Renderï¼ˆæ¸²æŸ“å™¨ï¼‰ps:commité˜¶æ®µ <a class="header-anchor" href="#render-æ¸²æŸ“å™¨-ps-commité˜¶æ®µ" aria-hidden="true">#</a></h3><p>Rendereræ ¹æ®Reconcilerä¸ºè™šæ‹ŸDOMæ‰“çš„æ ‡è®°ï¼ŒåŒæ­¥æ‰§è¡Œå¯¹åº”çš„DOMæ“ä½œã€‚</p><h3 id="æ€»ç»“" tabindex="-1">æ€»ç»“ â— <a class="header-anchor" href="#æ€»ç»“" aria-hidden="true">#</a></h3><ul><li>React16é‡‡ç”¨<code>Schedulerï¼ˆè°ƒåº¦å™¨ï¼‰</code>å’Œ<code>æ–°çš„Reconcile(åè°ƒå™¨)</code></li><li>Schedulerï¼ˆè°ƒåº¦å™¨ï¼‰ä¼šåœ¨æµè§ˆå™¨ç©ºé—²æ—¶è§¦å‘å›è°ƒçš„åŠŸèƒ½ï¼Œè¿˜ä¼šæ‰§è¡Œå…¶ä»–æ“ä½œã€‚</li><li>Reconciler(åè°ƒå™¨)å†…éƒ¨é‡‡ç”¨äº†<code>Fiber</code>çš„æ¶æ„ã€‚ç›®çš„æ˜¯ä¸ºäº†å®ç°å°†<strong>åŒæ­¥</strong>çš„æ›´æ–°å˜ä¸º<strong>å¯ä¸­æ–­çš„å¼‚æ­¥</strong>æ›´æ–°ã€‚</li><li>Schedulerï¼ˆè°ƒåº¦å™¨ï¼‰å’Œ Reconcile(åè°ƒå™¨)çš„å·¥ä½œä¸ä¼šè¢«ç”¨æˆ·çœ‹è§ã€‚åªæœ‰Renderï¼ˆæ¸²æŸ“å™¨ï¼‰ä¼šæ›´æ–°é¡µé¢ä¸Šçš„DOm</li></ul><h2 id="fiber" tabindex="-1">Fiber <a class="header-anchor" href="#fiber" aria-hidden="true">#</a></h2><h3 id="fiberæ¶æ„-å¿ƒæ™ºæ¨¡å¼" tabindex="-1">Fiberæ¶æ„ - å¿ƒæ™ºæ¨¡å¼ <a class="header-anchor" href="#fiberæ¶æ„-å¿ƒæ™ºæ¨¡å¼" aria-hidden="true">#</a></h3><p>Reactæ ¸å¿ƒå›¢é˜Ÿæˆå‘˜Sebastian MarkbÃ¥geï¼ˆReact Hooksçš„å‘æ˜è€…ï¼‰è¯´ï¼šæˆ‘ä»¬åœ¨Reactä¸­åšçš„å°±æ˜¯è·µè¡Œ<code>ä»£æ•°æ•ˆåº”</code>ï¼ˆAlgebraic Effectsï¼‰ã€‚</p><h4 id="ä»€ä¹ˆæ˜¯ä»£æ•°æ•ˆåº”" tabindex="-1">ä»€ä¹ˆæ˜¯ä»£æ•°æ•ˆåº” <a class="header-anchor" href="#ä»€ä¹ˆæ˜¯ä»£æ•°æ•ˆåº”" aria-hidden="true">#</a></h4><p><a href="https://overreacted.io/zh-hans/algebraic-effects-for-the-rest-of-us/" target="_blank" rel="noreferrer">ä»£æ•°æ•ˆåº”</a>ï¼šæ˜¯å‡½æ•°å¼ç¼–ç¨‹ä¸­çš„ä¸€ä¸ªæ¦‚å¿µï¼Œç”¨äºå°†å‰¯ä½œç”¨ä»å‡½æ•°è°ƒç”¨ä¸­åˆ†ç¦»ã€‚ä¹Ÿå°±æ˜¯è¯´èƒ½å¤Ÿå°†å‰¯ä½œç”¨ä»å‡½æ•°ä¸­é€»è¾‘ä¸­åˆ†ç¦»ï¼Œä½¿å¾—å‡½æ•°å…³æ³¨ç‚¹ä¿æŒå­˜ç²¹ã€‚</p><h4 id="ä»£æ•°æ•ˆåº”åœ¨reactä¸­çš„åº”ç”¨-hooks" tabindex="-1">ä»£æ•°æ•ˆåº”åœ¨Reactä¸­çš„åº”ç”¨ - <code>Hooks</code> <a class="header-anchor" href="#ä»£æ•°æ•ˆåº”åœ¨reactä¸­çš„åº”ç”¨-hooks" aria-hidden="true">#</a></h4><p>ä»£æ•°æ•ˆåº”åœ¨Reactä¸­æœ€æ˜æ˜¾çš„ä¾‹å­å°±æ˜¯<code>Hooks</code></p><p>å¯¹äºç±»ä¼¼useStateã€useReducerã€useRefè¿™æ ·çš„Hookï¼Œæˆ‘ä»¬ä¸éœ€è¦å…³æ³¨FunctionComponentçš„stateåœ¨Hookä¸­æ˜¯å¦‚ä½•ä¿å­˜çš„ï¼ŒReactä¼šä¸ºæˆ‘ä»¬å¤„ç†ã€‚</p><p>æˆ‘ä»¬åªéœ€è¦å‡è®¾useStateè¿”å›çš„æ˜¯æˆ‘ä»¬æƒ³è¦çš„stateï¼Œå¹¶ç¼–å†™ä¸šåŠ¡é€»è¾‘å°±è¡Œã€‚</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">App</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">num</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">updateNum</span><span style="color:#89DDFF;">]</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">useState</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> (</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">button</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">onClick</span><span style="color:#89DDFF;">={()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">updateNum</span><span style="color:#A6ACCD;">(</span><span style="color:#A6ACCD;font-style:italic;">num</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> num </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">}&gt;{</span><span style="color:#A6ACCD;">num</span><span style="color:#89DDFF;">}&lt;/</span><span style="color:#F07178;">button</span><span style="color:#89DDFF;">&gt;</span><span style="color:#F07178;">  </span></span>
<span class="line"><span style="color:#F07178;">  )</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h4 id="ä»£æ•°æ•ˆåº”å’Œfiber" tabindex="-1">ä»£æ•°æ•ˆåº”å’ŒFiber <a class="header-anchor" href="#ä»£æ•°æ•ˆåº”å’Œfiber" aria-hidden="true">#</a></h4><p>React Fiberå¯ä»¥ç†è§£ä¸ºï¼š</p><ul><li><p>Reactå†…éƒ¨å®ç°çš„ä¸€å¥—çŠ¶æ€æ›´æ–°æœºåˆ¶ã€‚æ”¯æŒä»»åŠ¡ä¸åŒ<code>ä¼˜å…ˆçº§</code>ï¼Œå¯ä¸­æ–­ä¸æ¢å¤ï¼Œå¹¶ä¸”æ¢å¤åå¯ä»¥å¤ç”¨ä¹‹å‰çš„<code>ä¸­é—´çŠ¶æ€</code>ã€‚</p></li><li><p>å…¶ä¸­æ¯ä¸ªä»»åŠ¡æ›´æ–°å•å…ƒä¸º<code>React Element</code>å¯¹åº”çš„<code>FiberèŠ‚ç‚¹</code>ã€‚</p></li></ul><h3 id="fiberæ¶æ„çš„å®ç°åŸç†" tabindex="-1">Fiberæ¶æ„çš„å®ç°åŸç† <a class="header-anchor" href="#fiberæ¶æ„çš„å®ç°åŸç†" aria-hidden="true">#</a></h3><p>åœ¨React15åŠä»¥å‰ï¼ŒReconcileré‡‡ç”¨<code>é€’å½’</code>çš„æ–¹å¼åˆ›å»ºè™šæ‹ŸDOMï¼Œé€’å½’è¿‡ç¨‹æ˜¯<code>ä¸èƒ½ä¸­æ–­</code>çš„ã€‚å¦‚æœç»„ä»¶æ ‘çš„å±‚çº§å¾ˆæ·±ï¼Œé€’å½’ä¼šå ç”¨çº¿ç¨‹å¾ˆå¤šæ—¶é—´ï¼Œé€ æˆå¡é¡¿ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒReact16å°†é€’å½’çš„æ— æ³•ä¸­æ–­çš„æ›´æ–°é‡æ„ä¸º<code>å¼‚æ­¥çš„å¯ä¸­æ–­æ›´æ–°</code>ï¼Œç”±äºæ›¾ç»ç”¨äºé€’å½’çš„è™šæ‹ŸDOMæ•°æ®ç»“æ„å·²ç»æ— æ³•æ»¡è¶³éœ€è¦ã€‚äºæ˜¯ï¼Œå…¨æ–°çš„<code>Fiberæ¶æ„</code>åº”è¿è€Œç”Ÿã€‚</p><p>FiberåŒ…å«ä¸‰å±‚å«ä¹‰ï¼š</p><ul><li>ä½œä¸º<code>æ¶æ„</code>æ¥è¯´ï¼Œä¹‹å‰React15çš„Reconcileré‡‡ç”¨é€’å½’çš„æ–¹å¼æ‰§è¡Œï¼Œæ•°æ®ä¿å­˜åœ¨é€’å½’è°ƒç”¨æ ˆä¸­ï¼Œæ‰€ä»¥è¢«ç§°ä¸º<code>stack Reconciler</code>ã€‚React16çš„ReconcileråŸºäºFiberèŠ‚ç‚¹å®ç°ï¼Œè¢«ç§°ä¸º<code>Fiber Reconciler</code>ã€‚</li><li>ä½œä¸º<code>é™æ€çš„æ•°æ®ç»“æ„</code>æ¥è¯´ï¼Œæ¯ä¸ªFiberèŠ‚ç‚¹å¯¹åº”ä¸€ä¸ª<code>React element</code>ï¼Œä¿å­˜äº†è¯¥ç»„ä»¶çš„ç±»å‹ï¼ˆå‡½æ•°ç»„ä»¶/ç±»ç»„ä»¶/åŸç”Ÿç»„ä»¶...ï¼‰ã€å¯¹åº”çš„<code>DOMèŠ‚ç‚¹</code>ç­‰ä¿¡æ¯ã€‚</li><li>ä½œä¸º<code>åŠ¨æ€çš„å·¥ä½œå•å…ƒ</code>æ¥è¯´ï¼Œæ¯ä¸ªFiberèŠ‚ç‚¹ä¿å­˜äº†æœ¬æ¬¡æ›´æ–°ä¸­è¯¥ç»„ä»¶<code>æ”¹å˜çš„çŠ¶æ€</code>ã€<code>è¦æ‰§è¡Œçš„å·¥ä½œ</code>ï¼ˆéœ€è¦è¢«åˆ é™¤/è¢«æ’å…¥é¡µé¢ä¸­/è¢«æ›´æ–°...ï¼‰ã€‚</li></ul><p><strong>åœ¨React16ä¸­ï¼Œè™šæ‹ŸDOMå°±æ˜¯fiber</strong></p><h3 id="fiberæ¶æ„çš„å·¥ä½œåŸç†-åŒç¼“å­˜" tabindex="-1">Fiberæ¶æ„çš„å·¥ä½œåŸç† - åŒç¼“å­˜ â— <a class="header-anchor" href="#fiberæ¶æ„çš„å·¥ä½œåŸç†-åŒç¼“å­˜" aria-hidden="true">#</a></h3><p>Reactä½¿ç”¨<code>â€œåŒç¼“å­˜â€</code>æ¥å®Œæˆ<code>Fiberæ ‘</code>çš„æ„å»ºä¸æ›¿æ¢ â€”â€” å¯¹åº”ç€<code>DOMæ ‘</code>çš„åˆ›å»ºä¸æ›´æ–°ã€‚</p><p>åœ¨Reactä¸­æœ€å¤šä¼šåŒæ—¶å­˜åœ¨ä¸¤æ£µFiberæ ‘ã€‚</p><ul><li>å½“å‰å±å¹•ä¸Š<code>æ˜¾ç¤ºå†…å®¹</code>å¯¹åº”çš„Fiberæ ‘ç§°ä¸º<code>current Fiberæ ‘</code>ï¼Œå…¶å¯¹åº”èŠ‚ç‚¹ä¸º<code>current fiber</code></li><li><code>æ­£åœ¨å†…å­˜ä¸­æ„å»º</code>çš„Fiberæ ‘ç§°ä¸º<code>workInProgress Fiberæ ‘</code>ï¼Œå…¶å¯¹åº”èŠ‚ç‚¹ä¸º<code>workInProgress fiber</code></li></ul><p><code>current fiber</code>å’Œ<code>workInProgress fiber</code>é€šè¿‡<code>alternate</code>å±æ€§è¿æ¥ã€‚</p><p>Reactåº”ç”¨çš„æ ¹èŠ‚ç‚¹é€šè¿‡ä½¿<code>current</code>æŒ‡é’ˆåœ¨ä¸åŒ<code>Fiberæ ‘</code>çš„<code>rootFiber</code>é—´åˆ‡æ¢æ¥å®Œæˆcurrent Fiberæ ‘æŒ‡å‘çš„åˆ‡æ¢ã€‚</p><p>â—å³å½“<code>workInProgress Fiberæ ‘</code>æ„å»ºå®Œæˆäº¤ç»™<code>Renderer</code>æ¸²æŸ“åœ¨é¡µé¢ä¸Šåï¼Œåº”ç”¨æ ¹èŠ‚ç‚¹çš„<code>current</code>æŒ‡é’ˆæŒ‡å‘<code>workInProgress Fiberæ ‘</code>ï¼Œæ­¤æ—¶<code>workInProgress Fiberæ ‘</code>å°±å˜ä¸º<code>current Fiberæ ‘</code>ã€‚</p><p><code>æ¯æ¬¡çŠ¶æ€æ›´æ–°</code>éƒ½ä¼šäº§ç”Ÿ<code>æ–°</code>çš„workInProgress Fiberæ ‘ï¼Œé€šè¿‡<code>current</code>ä¸<code>workInProgress</code>çš„<code>æ›¿æ¢</code>ï¼Œå®Œæˆ<code>DOM</code>æ›´æ–°ã€‚</p><p>fiberæ ‘çš„æ„å»º/æ›¿æ¢åˆ†ä¸º<code>mountæ—¶</code>ï¼Œ <code>updateæ—¶</code>ã€‚</p><h2 id="ä¸“ä¸šæœ¯è¯­è§£é‡Š-renderé˜¶æ®µã€commité˜¶æ®µç­‰ä¸æ€»ç»“" tabindex="-1">ä¸“ä¸šæœ¯è¯­è§£é‡Šï¼Œ renderé˜¶æ®µã€commité˜¶æ®µç­‰ä¸æ€»ç»“ â— <a class="header-anchor" href="#ä¸“ä¸šæœ¯è¯­è§£é‡Š-renderé˜¶æ®µã€commité˜¶æ®µç­‰ä¸æ€»ç»“" aria-hidden="true">#</a></h2><ul><li><code>Reconcilerï¼ˆåè°ƒå™¨ï¼‰</code>å·¥ä½œçš„é˜¶æ®µè¢«ç§°ä¸º<code>renderé˜¶æ®µ</code>ã€‚å› ä¸ºåœ¨è¯¥é˜¶æ®µä¼šè°ƒç”¨ç»„ä»¶çš„renderæ–¹æ³•ã€‚</li><li><code>Rendererï¼ˆæ¸²æŸ“å™¨ï¼‰</code>å·¥ä½œçš„é˜¶æ®µè¢«ç§°ä¸º<code>commité˜¶æ®µ</code>ã€‚commité˜¶æ®µä¼šæŠŠrenderé˜¶æ®µæäº¤çš„ä¿¡æ¯æ¸²æŸ“åœ¨é¡µé¢ä¸Šã€‚</li><li>renderä¸commité˜¶æ®µç»Ÿç§°ä¸º<code>work</code>ï¼Œå³Reactåœ¨å·¥ä½œä¸­ã€‚ç›¸å¯¹åº”çš„ï¼Œå¦‚æœä»»åŠ¡æ­£åœ¨<code>Scheduler(è°ƒåº¦å™¨)</code>å†…è°ƒåº¦ï¼Œå°±ä¸å±äºworkã€‚</li></ul><hr><ul><li><code>Schedulerï¼ˆè°ƒåº¦å™¨ï¼‰</code>â€”â€” è°ƒåº¦ä»»åŠ¡çš„ä¼˜å…ˆçº§ï¼Œé«˜ä¼˜ä»»åŠ¡ä¼˜å…ˆè¿›å…¥Reconcilerã€‚ä¼šåœ¨æµè§ˆå™¨ç©ºé—²æ—¶è§¦å‘å›è°ƒçš„åŠŸèƒ½ï¼Œè¿˜ä¼šæ‰§è¡Œå…¶ä»–æ“ä½œã€‚Scheduleræ˜¯ä¸€ä¸ªç‹¬ç«‹äºReactçš„åŒ…</li><li><code>Reconcilerï¼ˆåè°ƒå™¨ï¼‰</code>â€”â€” è´Ÿè´£æ‰¾å‡ºå˜åŒ–çš„ç»„ä»¶ã€‚åœ¨æ­¤å¼•ç”¨äº†<code>Fiberæ¶æ„</code>ï¼Œç›®çš„æ˜¯ä¸ºäº†å®ç°å°†<strong>åŒæ­¥</strong>çš„æ›´æ–°å˜ä¸º<strong>å¯ä¸­æ–­çš„å¼‚æ­¥</strong>æ›´æ–°ã€‚</li><li><code>Rendererï¼ˆæ¸²æŸ“å™¨ï¼‰</code>â€”â€” è´Ÿè´£å°†å˜åŒ–çš„ç»„ä»¶æ¸²æŸ“åˆ°é¡µé¢ä¸Š</li></ul><h1 id="renderé˜¶æ®µ" tabindex="-1">Renderé˜¶æ®µ â— <a class="header-anchor" href="#renderé˜¶æ®µ" aria-hidden="true">#</a></h1><p>æœ¬ç« æˆ‘ä»¬ä¼šè®²è§£<code>FiberèŠ‚ç‚¹</code>æ˜¯å¦‚ä½•è¢«åˆ›å»ºå¹¶æ„å»º<code>Fiberæ ‘</code>çš„ã€‚</p><h2 id="æµç¨‹æ¦‚è§ˆ" tabindex="-1">æµç¨‹æ¦‚è§ˆ <a class="header-anchor" href="#æµç¨‹æ¦‚è§ˆ" aria-hidden="true">#</a></h2><p><code>renderé˜¶æ®µ</code>å¼€å§‹äº<code>performSyncWorkOnRoot</code>æˆ–<code>performConcurrentWorkOnRoot</code>æ–¹æ³•çš„è°ƒç”¨ã€‚è¿™å–å†³äºæœ¬æ¬¡æ›´æ–°æ˜¯åŒæ­¥æ›´æ–°è¿˜æ˜¯å¼‚æ­¥æ›´æ–°ã€‚</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// performSyncWorkOnRootä¼šè°ƒç”¨è¯¥æ–¹æ³•</span></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">workLoopSync</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">while</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">workInProgress</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!==</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">performUnitOfWork</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">workInProgress</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// performConcurrentWorkOnRootä¼šè°ƒç”¨è¯¥æ–¹æ³•</span></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">workLoopConcurrent</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">while</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">workInProgress</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!==</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!</span><span style="color:#82AAFF;">shouldYield</span><span style="color:#F07178;">()) </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// å¦‚æœå½“å‰æµè§ˆå™¨å¸§æ²¡æœ‰å‰©ä½™æ—¶é—´ï¼ŒshouldYieldä¼šä¸­æ­¢å¾ªç¯ï¼Œç›´åˆ°æµè§ˆå™¨æœ‰ç©ºé—²æ—¶é—´åå†ç»§ç»­éå†ã€‚</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">performUnitOfWork</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">workInProgress</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p><code>performUnitOfWork</code>æ–¹æ³•ä¼šåˆ›å»ºä¸‹ä¸€ä¸ª<code>FiberèŠ‚ç‚¹</code>å¹¶èµ‹å€¼ç»™<code>workInProgress</code>ï¼Œå¹¶å°†workInProgressä¸å·²åˆ›å»ºçš„FiberèŠ‚ç‚¹è¿æ¥èµ·æ¥æ„æˆFiberæ ‘ã€‚</p><p>Fiber Reconciler(åè°ƒå™¨)é€šè¿‡éå†çš„æ–¹å¼å®ç°å¯ä¸­æ–­çš„é€’å½’ï¼Œæ‰€ä»¥<code>performUnitOfWork</code>çš„å·¥ä½œå¯ä»¥åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šâ€œé€’â€å’Œâ€œå½’â€ã€‚</p><h3 id="é€’-é˜¶æ®µ" tabindex="-1">â€œé€’â€é˜¶æ®µ <a class="header-anchor" href="#é€’-é˜¶æ®µ" aria-hidden="true">#</a></h3><ul><li>é¦–å…ˆä»<code>rootFiber</code>å¼€å§‹å‘ä¸‹æ·±åº¦ä¼˜å…ˆéå†ã€‚ä¸ºéå†åˆ°çš„æ¯ä¸ªFiberèŠ‚ç‚¹è°ƒç”¨<code>beginWorkæ–¹æ³•</code>ã€‚ğŸ‘</li><li>è¯¥æ–¹æ³•ä¼šæ ¹æ®ä¼ å…¥çš„FiberèŠ‚ç‚¹åˆ›å»ºå­FiberèŠ‚ç‚¹ï¼Œå¹¶å°†è¿™ä¸¤ä¸ªFiberèŠ‚ç‚¹è¿æ¥èµ·æ¥ã€‚</li><li>å½“éå†åˆ°å¶å­èŠ‚ç‚¹ï¼ˆå³æ²¡æœ‰å­ç»„ä»¶çš„ç»„ä»¶ï¼‰æ—¶å°±ä¼šè¿›å…¥â€œå½’â€é˜¶æ®µã€‚</li></ul><h3 id="å½’-é˜¶æ®µ" tabindex="-1">â€œå½’â€é˜¶æ®µ <a class="header-anchor" href="#å½’-é˜¶æ®µ" aria-hidden="true">#</a></h3><ul><li>åœ¨â€œå½’â€é˜¶æ®µä¼šè°ƒç”¨<code>completeWork</code>å¤„ç†FiberèŠ‚ç‚¹ã€‚ğŸ‘</li><li>å½“æŸä¸ªFiberèŠ‚ç‚¹æ‰§è¡Œå®ŒcompleteWorkï¼Œå¦‚æœå…¶å­˜åœ¨å…„å¼ŸFiberèŠ‚ç‚¹ï¼ˆå³fiber.sibling !== nullï¼‰ï¼Œä¼šè¿›å…¥å…¶<code>å…„å¼ŸFiber</code>çš„â€œé€’â€é˜¶æ®µã€‚</li><li>å¦‚æœä¸å­˜åœ¨å…„å¼ŸFiberï¼Œä¼šè¿›å…¥<code>çˆ¶çº§Fiber</code>çš„â€œå½’â€é˜¶æ®µã€‚</li><li>â€œé€’â€å’Œâ€œå½’â€é˜¶æ®µä¼šäº¤é”™æ‰§è¡Œç›´åˆ°â€œå½’â€åˆ°rootFiberã€‚è‡³æ­¤ï¼Œrenderé˜¶æ®µçš„å·¥ä½œå°±ç»“æŸäº†ã€‚</li></ul><h3 id="ä¾‹å­" tabindex="-1">ä¾‹å­ <a class="header-anchor" href="#ä¾‹å­" aria-hidden="true">#</a></h3><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">App</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> (</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">      i am</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">span</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">KaSong</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">span</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#F07178;">  )</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">ReactDOM</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">render</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">App</span><span style="color:#89DDFF;"> /&gt;,</span><span style="color:#A6ACCD;"> document</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getElementById</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">root</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><img src="`+l+`" width="60%/"><h2 id="é€’-é˜¶æ®µ-beginwork" tabindex="-1">â€œé€’â€é˜¶æ®µ - beginWork <a class="header-anchor" href="#é€’-é˜¶æ®µ-beginwork" aria-hidden="true">#</a></h2><p><a href="https://github.com/facebook/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react-reconciler/src/ReactFiberBeginWork.new.js#L3075" target="_blank" rel="noreferrer">æºç åœ¨æ­¤</a></p><p>beginWorkçš„å·¥ä½œæ˜¯ä¼ å…¥<code>å½“å‰Fiber</code>èŠ‚ç‚¹ï¼Œåˆ›å»º<code>å­Fiber</code>èŠ‚ç‚¹ã€‚</p><p>beginWorkçš„å·¥ä½œå¯ä»¥åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š</p><ul><li><strong>updateæ—¶</strong>ï¼šå¦‚æœ<code>current</code>å­˜åœ¨ï¼Œåœ¨æ»¡è¶³ä¸€å®šæ¡ä»¶æ—¶å¯ä»¥å¤ç”¨currentèŠ‚ç‚¹ï¼Œè¿™æ ·å°±èƒ½å…‹éš†current.childä½œä¸ºworkInProgress.childï¼Œè€Œä¸éœ€è¦æ–°å»ºworkInProgress.childã€‚</li><li><strong>mountæ—¶</strong>ï¼šé™¤<code>fiberRootNode</code>ä»¥å¤–ï¼Œcurrent === nullã€‚ä¼šæ ¹æ®<code>fiber.tag</code>ä¸åŒï¼Œè¿›å…¥ä¸åŒç±»å‹Fiberçš„åˆ›å»ºé€»è¾‘ã€‚åˆ›å»ºä¸åŒç±»å‹çš„å­FiberèŠ‚ç‚¹ã€‚</li></ul><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">beginWork</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#A6ACCD;font-style:italic;">current</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Fiber</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">null</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">//å½“å‰ç»„ä»¶å¯¹åº”çš„FiberèŠ‚ç‚¹åœ¨ä¸Šä¸€æ¬¡æ›´æ–°æ—¶çš„FiberèŠ‚ç‚¹ï¼Œå³workInProgress.alternate</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#A6ACCD;font-style:italic;">workInProgress</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Fiber</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// å½“å‰ç»„ä»¶å¯¹åº”çš„FiberèŠ‚ç‚¹</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#A6ACCD;font-style:italic;">renderLanes</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Lanes</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// ä¼˜å…ˆçº§ç›¸å…³</span></span>
<span class="line"><span style="color:#89DDFF;">):</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Fiber</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">null</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// updateæ—¶ï¼šå¦‚æœcurrentå­˜åœ¨å¯èƒ½å­˜åœ¨ä¼˜åŒ–è·¯å¾„ï¼Œå¯ä»¥å¤ç”¨currentï¼ˆå³ä¸Šä¸€æ¬¡æ›´æ–°çš„FiberèŠ‚ç‚¹ï¼‰</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">current</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!==</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// ...çœç•¥</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// å¤ç”¨current</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">bailoutOnAlreadyFinishedWork</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">current</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">workInProgress</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">renderLanes</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    )</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">didReceiveUpdate</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// mountæ—¶ï¼šæ ¹æ®tagä¸åŒï¼Œåˆ›å»ºä¸åŒçš„å­FiberèŠ‚ç‚¹</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">switch</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">workInProgress</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">tag</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">IndeterminateComponent</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// ...çœç•¥</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">LazyComponent</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// ...çœç•¥</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">FunctionComponent</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// ...çœç•¥</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ClassComponent</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// ...çœç•¥</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">HostRoot</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// ...çœç•¥</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">HostComponent</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// ...çœç•¥</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">HostText</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// ...çœç•¥</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// ...çœç•¥å…¶ä»–ç±»å‹</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>å¯¹äºæˆ‘ä»¬å¸¸è§çš„ç»„ä»¶ç±»å‹ï¼Œå¦‚ï¼ˆFunctionComponent/ClassComponent/HostComponentï¼‰ï¼Œæœ€ç»ˆä¼šè¿›å…¥<code>reconcileChildren</code>æ–¹æ³•ã€‚</p><ul><li><strong>reconcileChildren</strong>ï¼š é€šè¿‡current === null åŒºåˆ†mountä¸update <ul><li>å¯¹äº<strong>mount</strong>çš„ç»„ä»¶ï¼Œä»–ä¼šåˆ›å»ºæ–°çš„å­FiberèŠ‚ç‚¹ã€‚è°ƒç”¨<code>mountChildFibers</code>æ–¹æ³•</li><li>å¯¹äº<strong>update</strong>çš„ç»„ä»¶ï¼Œä»–ä¼šå°†å½“å‰ç»„ä»¶ä¸è¯¥ç»„ä»¶åœ¨ä¸Šæ¬¡æ›´æ–°æ—¶å¯¹åº”çš„FiberèŠ‚ç‚¹æ¯”è¾ƒï¼ˆä¹Ÿå°±æ˜¯ä¿—ç§°çš„<strong>Diff</strong>ç®—æ³•â—ï¼‰ï¼Œå°†æ¯”è¾ƒçš„ç»“æœç”Ÿæˆæ–°FiberèŠ‚ç‚¹ã€‚è°ƒç”¨<code>reconcileChildFibers</code>æ–¹æ³•ï¼Œä¼šä¸ºFiberèŠ‚ç‚¹å¸¦ä¸Š<code>effectTag</code>å±æ€§ã€‚</li></ul></li><li><strong>effectTag</strong>ï¼šå®ƒè¡¨ç¤ºï¼ŒRenderé˜¶æ®µç»“æŸåï¼Œé€šçŸ¥Renderï¼ˆæ¸²æŸ“å™¨ï¼‰è¦æ‰§è¡Œçš„DOMæ“ä½œç±»å‹ã€‚ä¿å­˜åœ¨<code>fiber.effectTag</code>ä¸Šã€‚<div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// DOMéœ€è¦æ’å…¥åˆ°é¡µé¢ä¸­</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> Placement </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">/*                */</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0b00000000000010</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// DOMéœ€è¦æ›´æ–°</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> Update </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">/*                   */</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0b00000000000100</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// DOMéœ€è¦æ’å…¥åˆ°é¡µé¢ä¸­å¹¶æ›´æ–°</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> PlacementAndUpdate </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">/*       */</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0b00000000000110</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// DOMéœ€è¦åˆ é™¤</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> Deletion </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">/*                 */</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0b0000000000100</span></span>
<span class="line"></span></code></pre></div></li></ul><img src="`+o+'"><h2 id="å½’-é˜¶æ®µ-completework" tabindex="-1">&quot;å½’&quot;é˜¶æ®µ - completeWork <a class="header-anchor" href="#å½’-é˜¶æ®µ-completework" aria-hidden="true">#</a></h2><p>completeWorkçš„ç›®çš„å°±æ˜¯ä¸ºäº†<code>åˆ›å»ºå¥½å¯¹åº”çš„domèŠ‚ç‚¹</code>æ’å…¥å¯¹åº”çš„<code>çˆ¶çº§èŠ‚ç‚¹</code>çš„domèŠ‚ç‚¹, ä¸ºå…¶æ·»åŠ <code>å‰¯ä½œç”¨</code>æ ‡è¯†ã€‚</p><p>completeWorkçš„ä¸Šå±‚å‡½æ•°<code>completeUnitOfWork</code>ä¸­ï¼Œæ¯ä¸ªæ‰§è¡Œå®ŒcompleteWorkä¸”å­˜åœ¨<code>effectTag</code>çš„FiberèŠ‚ç‚¹ä¼šè¢«ä¿å­˜åœ¨ä¸€æ¡è¢«ç§°ä¸º<code>effectList</code>çš„å•å‘é“¾è¡¨ä¸­ã€‚effectListä¸­ä¿å­˜æ‰€æœ‰çš„effectTagã€‚</p><img src="'+c+'"><h1 id="commité˜¶æ®µ" tabindex="-1">commité˜¶æ®µ <a class="header-anchor" href="#commité˜¶æ®µ" aria-hidden="true">#</a></h1><p>ä¸€äº›<code>å‰¯ä½œç”¨</code>å¯¹åº”çš„DOMæ“ä½œã€ä¸€äº›ç”Ÿå‘½å‘¨æœŸé’©å­ï¼ˆcomponentDidXXXï¼‰ã€æŸäº›hookï¼ˆuseEffectï¼‰éƒ½åœ¨commité˜¶æ®µæ‰§è¡Œ</p><p>commité˜¶æ®µçš„ä¸»è¦å·¥ä½œï¼ˆå³Rendererçš„å·¥ä½œæµç¨‹ï¼‰åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š</p><ul><li>before mutationé˜¶æ®µï¼ˆæ‰§è¡ŒDOMæ“ä½œå‰ï¼‰</li><li>mutationé˜¶æ®µï¼ˆæ‰§è¡ŒDOMæ“ä½œï¼‰</li><li>layouté˜¶æ®µï¼ˆæ‰§è¡ŒDOMæ“ä½œåï¼‰</li></ul><p>å¦å¤–ï¼Œ</p><ul><li>åœ¨before mutationä¹‹å‰ï¼šä¸»è¦åšä¸€äº›å˜é‡èµ‹å€¼ï¼ŒçŠ¶æ€é‡ç½®çš„å·¥ä½œã€‚</li><li>åœ¨layouté˜¶æ®µä¹‹åï¼š1. useEffectç›¸å…³å¤„ç† 2. æ€§èƒ½è¿½è¸ªç›¸å…³ 3. æ‰§è¡ŒåŒæ­¥ä»»åŠ¡, æ¯”å¦‚åœ¨ componentDidMount ä¸­æ‰§è¡Œ setState åˆ›å»ºçš„æ›´æ–°ä¼šåœ¨è¿™é‡Œè¢«åŒæ­¥æ‰§è¡Œ, useLayoutEffectã€useEffectçš„å›è°ƒæ–¹æ³•ä¹Ÿä¼šåœ¨è¿™é‡Œè¢«æ‰§è¡Œ</li></ul><h2 id="before-mutationé˜¶æ®µ-æ‰§è¡Œdomæ“ä½œå‰" tabindex="-1">before mutationé˜¶æ®µï¼ˆæ‰§è¡ŒDOMæ“ä½œå‰ï¼‰ <a class="header-anchor" href="#before-mutationé˜¶æ®µ-æ‰§è¡Œdomæ“ä½œå‰" aria-hidden="true">#</a></h2><p>åœ¨before mutationé˜¶æ®µï¼Œä¼šéå†<code>effectList</code>ï¼ˆä¿å­˜effectTagçš„å•å‘é“¾è¡¨ï¼‰ï¼Œå¹¶è°ƒç”¨<code>commitBeforeMutationEffects</code>å‡½æ•°ï¼Œä¾æ¬¡æ‰§è¡Œï¼š</p><ol><li>å¤„ç†DOMèŠ‚ç‚¹æ¸²æŸ“/åˆ é™¤åçš„ autoFocusã€bluré€»è¾‘</li><li>è°ƒç”¨getSnapshotBeforeUpdateç”Ÿå‘½å‘¨æœŸé’©å­</li><li>è°ƒåº¦useEffect</li></ol><h2 id="mutationé˜¶æ®µ-æ‰§è¡Œdomæ“ä½œ" tabindex="-1">mutationé˜¶æ®µï¼ˆæ‰§è¡ŒDOMæ“ä½œï¼‰ <a class="header-anchor" href="#mutationé˜¶æ®µ-æ‰§è¡Œdomæ“ä½œ" aria-hidden="true">#</a></h2><p>mutationé˜¶æ®µä¼šéå† <code>effectList</code>ï¼Œä¾æ¬¡æ‰§è¡Œ<code>commitMutationEffects</code>ã€‚è¯¥æ–¹æ³•çš„ä¸»è¦å·¥ä½œä¸ºæ ¹æ®<code>effectTag</code>è°ƒç”¨ä¸åŒçš„å¤„ç†å‡½æ•°<code>å¤„ç†Fiber</code></p><h2 id="layouté˜¶æ®µ-æ‰§è¡Œdomæ“ä½œå" tabindex="-1">layouté˜¶æ®µï¼ˆæ‰§è¡ŒDOMæ“ä½œåï¼‰ <a class="header-anchor" href="#layouté˜¶æ®µ-æ‰§è¡Œdomæ“ä½œå" aria-hidden="true">#</a></h2><p>layouté˜¶æ®µä¼šéå† <code>effectList</code>ï¼Œä¾æ¬¡æ‰§è¡Œ<code>commitLayoutEffects</code>ã€‚è¯¥æ–¹æ³•çš„ä¸»è¦å·¥ä½œä¸ºæ ¹æ®<code>effectTag</code>è°ƒç”¨ä¸åŒçš„å¤„ç†å‡½æ•°<code>å¤„ç†Fiber</code>å¹¶æ›´æ–°<code>ref</code>ã€‚</p><h1 id="diffç®—æ³•" tabindex="-1">Diffç®—æ³• <a class="header-anchor" href="#diffç®—æ³•" aria-hidden="true">#</a></h1>',113),p=[t];function i(d,F,y,D,h,A){return s(),a("div",null,p)}const C=e(r,[["render",i]]);export{f as __pageData,C as default};
