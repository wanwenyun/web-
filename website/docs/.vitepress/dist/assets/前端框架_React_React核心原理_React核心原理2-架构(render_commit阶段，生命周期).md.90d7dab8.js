import{_ as s,o as n,c as a,V as o}from"./chunks/framework.75331a37.js";const e="/assets/lifeCycle.f8571c7a.png",l="/assets/reactRender.cb228ac9.png",p="/assets/beginWork.7b9f4e1d.png",t="/assets/completeWork.4557c553.png",u=JSON.parse('{"title":"Reactç”Ÿå‘½å‘¨æœŸ","description":"","frontmatter":{},"headers":[],"relativePath":"å‰ç«¯æ¡†æ¶/React/Reactæ ¸å¿ƒåŸç†/Reactæ ¸å¿ƒåŸç†2-æ¶æ„(render,commité˜¶æ®µï¼Œç”Ÿå‘½å‘¨æœŸ).md","filePath":"å‰ç«¯æ¡†æ¶/React/Reactæ ¸å¿ƒåŸç†/Reactæ ¸å¿ƒåŸç†2-æ¶æ„(render,commité˜¶æ®µï¼Œç”Ÿå‘½å‘¨æœŸ).md"}'),c={name:"å‰ç«¯æ¡†æ¶/React/Reactæ ¸å¿ƒåŸç†/Reactæ ¸å¿ƒåŸç†2-æ¶æ„(render,commité˜¶æ®µï¼Œç”Ÿå‘½å‘¨æœŸ).md"},r=o('<ul><li><a href="#reactç”Ÿå‘½å‘¨æœŸ">Reactç”Ÿå‘½å‘¨æœŸ</a></li><li><a href="#ä¸“ä¸šæœ¯è¯­è§£é‡Š-renderé˜¶æ®µcommité˜¶æ®µç­‰ä¸æ€»ç»“-heavy_exclamation_mark">ä¸“ä¸šæœ¯è¯­è§£é‡Šï¼Œ renderé˜¶æ®µã€commité˜¶æ®µç­‰ä¸æ€»ç»“ :heavy_exclamation_mark</a></li><li><a href="#renderé˜¶æ®µ-heavy_exclamation_mark">Renderé˜¶æ®µ :heavy_exclamation_mark</a><ul><li><a href="#æµç¨‹æ¦‚è§ˆ">æµç¨‹æ¦‚è§ˆ</a><ul><li><a href="#é€’é˜¶æ®µ----beginwork">â€œé€’â€é˜¶æ®µ -- beginWork</a></li><li><a href="#å½’é˜¶æ®µ----completework">â€œå½’â€é˜¶æ®µ -- completeWork</a></li><li><a href="#ä¾‹å­">ä¾‹å­</a></li></ul></li><li><a href="#é€’é˜¶æ®µ---beginwork">â€œé€’â€é˜¶æ®µ - beginWork</a><ul><li><a href="#reconcilechildren">reconcileChildren</a></li><li><a href="#effecttag">effectTag</a></li><li><a href="#æ€»ç»“">æ€»ç»“</a></li></ul></li><li><a href="#å½’é˜¶æ®µ---completework">&quot;å½’&quot;é˜¶æ®µ - completeWork</a><ul><li><a href="#hostcomponenå¦‚ä½•å¤„ç†">HostComponenå¦‚ä½•å¤„ç†</a></li><li><a href="#effectlist"><code>effectList</code></a></li><li><a href="#æ€»ç»“-1">æ€»ç»“</a></li></ul></li></ul></li><li><a href="#commité˜¶æ®µ">commité˜¶æ®µ</a><ul><li><a href="#before-mutationé˜¶æ®µæ‰§è¡Œdomæ“ä½œå‰">before mutationé˜¶æ®µï¼ˆæ‰§è¡ŒDOMæ“ä½œå‰ï¼‰</a></li><li><a href="#mutationé˜¶æ®µæ‰§è¡Œdomæ“ä½œ">mutationé˜¶æ®µï¼ˆæ‰§è¡ŒDOMæ“ä½œï¼‰</a><ul><li><a href="#placement-effect">Placement effect</a></li><li><a href="#update-effect">Update effect</a></li><li><a href="#deletion-effect">Deletion effect</a></li></ul></li><li><a href="#layouté˜¶æ®µæ‰§è¡Œdomæ“ä½œå">layouté˜¶æ®µï¼ˆæ‰§è¡ŒDOMæ“ä½œåï¼‰</a></li></ul></li></ul><h1 id="reactç”Ÿå‘½å‘¨æœŸ" tabindex="-1">Reactç”Ÿå‘½å‘¨æœŸ <a class="header-anchor" href="#reactç”Ÿå‘½å‘¨æœŸ" aria-label="Permalink to &quot;Reactç”Ÿå‘½å‘¨æœŸ&quot;">â€‹</a></h1><img src="'+e+`"><h1 id="ä¸“ä¸šæœ¯è¯­è§£é‡Š-renderé˜¶æ®µã€commité˜¶æ®µç­‰ä¸æ€»ç»“-heavy-exclamation-mark" tabindex="-1">ä¸“ä¸šæœ¯è¯­è§£é‡Šï¼Œ renderé˜¶æ®µã€commité˜¶æ®µç­‰ä¸æ€»ç»“ :heavy_exclamation_mark <a class="header-anchor" href="#ä¸“ä¸šæœ¯è¯­è§£é‡Š-renderé˜¶æ®µã€commité˜¶æ®µç­‰ä¸æ€»ç»“-heavy-exclamation-mark" aria-label="Permalink to &quot;ä¸“ä¸šæœ¯è¯­è§£é‡Šï¼Œ renderé˜¶æ®µã€commité˜¶æ®µç­‰ä¸æ€»ç»“ :heavy_exclamation_mark&quot;">â€‹</a></h1><p><a href="https://github.com/mbaxszy7/blog/issues/16" target="_blank" rel="noreferrer">å‚è€ƒé“¾æ¥</a></p><ul><li><strong>Renderé˜¶æ®µ -- ç¡®å®šæ›´æ–°ç»†èŠ‚</strong><ul><li><strong>åœ¨renderé˜¶æ®µï¼ŒReactå°†</strong>æ›´æ–°<strong>åº”ç”¨äºé€šè¿‡<code>setStateæˆ–render</code>æ–¹æ³•è§¦å‘çš„ç»„ä»¶ï¼Œå¹¶ç¡®å®šéœ€è¦åœ¨ç”¨æˆ·å±å¹•ä¸Šåšå“ªäº›æ›´æ–°--å“ªäº›èŠ‚ç‚¹éœ€è¦æ’å…¥ï¼Œæ›´æ–°æˆ–åˆ é™¤ï¼Œå“ªäº›ç»„ä»¶éœ€è¦è°ƒç”¨å…¶ç”Ÿå‘½å‘¨æœŸæ–¹æ³•</strong>ã€‚</li><li>æœ€ç»ˆçš„è¿™äº›æ›´æ–°ä¿¡æ¯è¢«ä¿å­˜åœ¨ä¸€ä¸ªå«<code>effect list</code>çš„<code>fiber</code> èŠ‚ç‚¹æ ‘ä¸Š</li><li>å½“ç„¶ï¼Œåœ¨é¦–æ¬¡æ¸²æŸ“æ—¶ï¼ŒReactä¸éœ€è¦äº§ç”Ÿä»»ä½•æ›´æ–°ä¿¡æ¯ï¼Œè€Œæ˜¯ä¼šç»™æ¯ä¸ªä»renderæ–¹æ³•è¿”å›çš„elementç”Ÿæˆä¸€ä¸ªfiberèŠ‚ç‚¹ï¼Œæœ€ç»ˆç”Ÿæˆä¸€ä¸ªfiberèŠ‚ç‚¹æ ‘ï¼Œ åç»­çš„æ›´æ–°ä¹Ÿæ˜¯å¤ç”¨äº†è¿™æ£µfiberæ ‘ã€‚</li></ul></li><li><strong>Commité˜¶æ®µ -- å°†æ›´æ–°ä½œç”¨åˆ°Domæ ‘ä¸Š</strong><ul><li>åœ¨è¿™ä¸ªé˜¶æ®µæ—¶ï¼ŒReactå†…éƒ¨ä¼šæœ‰2ä¸ªfiberæ ‘å’Œä¸€ä¸ªlistï¼š <ol><li><code>current fiber tree</code>: è¡¨ç¤º<code>æ˜¾ç¤ºå†…å®¹</code>å¯¹åº”çš„Fiberæ ‘ã€‚åœ¨é¦–æ¬¡æ¸²æŸ“æ—¶ï¼ŒReactä¸éœ€è¦äº§ç”Ÿä»»ä½•æ›´æ–°ä¿¡æ¯ï¼Œè€Œæ˜¯ä¼šç»™æ¯ä¸ªä»renderæ–¹æ³•è¿”å›çš„elementç”Ÿæˆä¸€ä¸ªfiberèŠ‚ç‚¹ï¼Œæœ€ç»ˆç”Ÿæˆä¸€ä¸ªfiberèŠ‚ç‚¹æ ‘ï¼Œ åç»­çš„æ›´æ–°ä¹Ÿæ˜¯å¤ç”¨äº†è¿™æ£µfiberæ ‘ã€‚</li><li><code>workInProgress fiber tree</code>: è¡¨ç¤º<code>æ­£åœ¨å†…å­˜ä¸­æ„å»º</code>çš„Fiberæ ‘ã€‚æ‰€æœ‰çš„æ›´æ–°è®¡ç®—å·¥ä½œéƒ½åœ¨workInProgress treeçš„fiberä¸Šæ‰§è¡Œã€‚å½“React éå†current fiber treeæ—¶ï¼Œå®ƒä¸ºæ¯ä¸ªcurrent fiber åˆ›å»ºä¸€ä¸ªæ›¿ä»£ï¼ˆalternateï¼‰èŠ‚ç‚¹ï¼Œè¿™æ ·çš„alternateèŠ‚ç‚¹æ„æˆäº†workInProgress tree</li><li><code>effect list</code>: æ˜¯workInProgress fiber tree çš„å­æ ‘ï¼Œå®ƒçš„ä½œç”¨æ˜¯ä¸²è”äº†æ ‡è®°å…·æœ‰æ›´æ–°çš„èŠ‚ç‚¹</li></ol></li><li><strong>Commité˜¶æ®µä¼šéå†effect listï¼ŒæŠŠæ‰€æœ‰æ›´æ–°éƒ½commitåˆ°<code>DOMæ ‘</code>ä¸Š</strong>ã€‚å…·ä½“å¦‚ä¸‹ <ol><li>é¦–å…ˆä¼šæœ‰ä¸€ä¸ªpre-commité˜¶æ®µï¼Œä¸»è¦æ˜¯æ‰§è¡Œ<code>getSnapshotBeforeUpdate</code>æ–¹æ³•ï¼Œå¯ä»¥è·å–å½“å‰DOMçš„å¿«ç…§ï¼ˆsnapï¼‰</li><li>ç„¶åç»™éœ€è¦å¸è½½çš„ç»„ä»¶æ‰§è¡ŒcomponentWillUnmountæ–¹æ³•</li><li>æ¥ç€ä¼šæŠŠcurrent fiber tree æ›¿æ¢ä¸ºworkInProgress fiber tree</li><li>æœ€åæ‰§è¡ŒDOMçš„æ’å…¥ã€æ›´æ–°å’Œåˆ é™¤ï¼Œç»™æ›´æ–°çš„ç»„ä»¶æ‰§è¡ŒcomponentDidUpdateï¼Œç»™æ’å…¥çš„ç»„ä»¶æ‰§è¡ŒcomponentDidMount</li></ol></li><li>é‡ç‚¹è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸€é˜¶æ®µæ˜¯<strong>åŒæ­¥æ‰§è¡Œçš„ï¼Œä¸èƒ½ä¸­æ­¢</strong>ã€‚</li></ul></li></ul><hr><ul><li><code>Schedulerï¼ˆè°ƒåº¦å™¨ï¼‰</code>â€”â€” è°ƒåº¦ä»»åŠ¡çš„ä¼˜å…ˆçº§ï¼Œé«˜ä¼˜ä»»åŠ¡ä¼˜å…ˆè¿›å…¥Reconcilerã€‚ä¼šåœ¨æµè§ˆå™¨ç©ºé—²æ—¶è§¦å‘å›è°ƒçš„åŠŸèƒ½ï¼Œè¿˜ä¼šæ‰§è¡Œå…¶ä»–æ“ä½œã€‚Scheduleræ˜¯ä¸€ä¸ªç‹¬ç«‹äºReactçš„åŒ…</li><li><code>Reconcilerï¼ˆåè°ƒå™¨ï¼‰</code>â€”â€” <strong>è´Ÿè´£æ‰¾å‡ºå˜åŒ–çš„ç»„ä»¶ï¼Œç¡®å®šæ›´æ–°ç»†èŠ‚</strong>ã€‚åœ¨æ­¤å¼•ç”¨äº†<code>Fiberæ¶æ„</code>ï¼Œç›®çš„æ˜¯ä¸ºäº†å®ç°å°†<strong>åŒæ­¥</strong>çš„æ›´æ–°å˜ä¸º<strong>å¯ä¸­æ–­çš„å¼‚æ­¥</strong>æ›´æ–°ã€‚å…¶å·¥ä½œçš„é˜¶æ®µè¢«ç§°ä¸º<code>renderé˜¶æ®µ</code>ã€‚å› ä¸ºåœ¨è¯¥é˜¶æ®µä¼šè°ƒç”¨ç»„ä»¶çš„renderæ–¹æ³•ã€‚</li><li><code>Rendererï¼ˆæ¸²æŸ“å™¨ï¼‰</code>â€”â€” è´Ÿè´£å°†å˜åŒ–çš„ç»„ä»¶æ¸²æŸ“åˆ°é¡µé¢ä¸Šå…¶å·¥ä½œçš„é˜¶æ®µè¢«ç§°ä¸º<code>commité˜¶æ®µ</code>ã€‚commité˜¶æ®µä¼šæŠŠrenderé˜¶æ®µæäº¤çš„ä¿¡æ¯<strong>æ¸²æŸ“</strong>åœ¨é¡µé¢ä¸Šã€‚</li></ul><p>renderä¸commité˜¶æ®µç»Ÿç§°ä¸º<code>work</code>ï¼Œå³Reactåœ¨å·¥ä½œä¸­ã€‚ç›¸å¯¹åº”çš„ï¼Œå¦‚æœä»»åŠ¡æ­£åœ¨<code>Scheduler(è°ƒåº¦å™¨)</code>å†…è°ƒåº¦ï¼Œå°±ä¸å±äºworkã€‚</p><h1 id="renderé˜¶æ®µ-heavy-exclamation-mark" tabindex="-1">Renderé˜¶æ®µ :heavy_exclamation_mark <a class="header-anchor" href="#renderé˜¶æ®µ-heavy-exclamation-mark" aria-label="Permalink to &quot;Renderé˜¶æ®µ :heavy_exclamation_mark&quot;">â€‹</a></h1><p>æœ¬ç« æˆ‘ä»¬ä¼šè®²è§£<code>FiberèŠ‚ç‚¹</code>æ˜¯å¦‚ä½•è¢«åˆ›å»ºå¹¶æ„å»º<code>Fiberæ ‘</code>çš„ã€‚</p><h2 id="æµç¨‹æ¦‚è§ˆ" tabindex="-1">æµç¨‹æ¦‚è§ˆ <a class="header-anchor" href="#æµç¨‹æ¦‚è§ˆ" aria-label="Permalink to &quot;æµç¨‹æ¦‚è§ˆ&quot;">â€‹</a></h2><p>åœ¨<code>render</code>é˜¶æ®µï¼ŒReactå°†æ›´æ–°åº”ç”¨äºé€šè¿‡setStateæˆ–renderæ–¹æ³•è§¦å‘çš„ç»„ä»¶ï¼Œå¹¶ç¡®å®šéœ€è¦åœ¨ç”¨æˆ·å±å¹•ä¸Šåšå“ªäº›æ›´æ–°--å“ªäº›èŠ‚ç‚¹éœ€è¦æ’å…¥ï¼Œæ›´æ–°æˆ–åˆ é™¤ï¼Œå“ªäº›ç»„ä»¶éœ€è¦è°ƒç”¨å…¶ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ã€‚</p><p><code>renderé˜¶æ®µ</code>å¼€å§‹äº<code>performSyncWorkOnRoot</code>æˆ–<code>performConcurrentWorkOnRoot</code>æ–¹æ³•çš„è°ƒç”¨ã€‚è¿™å–å†³äºæœ¬æ¬¡æ›´æ–°æ˜¯åŒæ­¥æ›´æ–°è¿˜æ˜¯å¼‚æ­¥æ›´æ–°ã€‚</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// performSyncWorkOnRootä¼šè°ƒç”¨è¯¥æ–¹æ³•</span></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">workLoopSync</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">while</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">workInProgress</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!==</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">performUnitOfWork</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">workInProgress</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// performConcurrentWorkOnRootä¼šè°ƒç”¨è¯¥æ–¹æ³•</span></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">workLoopConcurrent</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">while</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">workInProgress</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!==</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!</span><span style="color:#82AAFF;">shouldYield</span><span style="color:#F07178;">()) </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// å¦‚æœå½“å‰æµè§ˆå™¨å¸§æ²¡æœ‰å‰©ä½™æ—¶é—´ï¼ŒshouldYieldä¼šä¸­æ­¢å¾ªç¯ï¼Œç›´åˆ°æµè§ˆå™¨æœ‰ç©ºé—²æ—¶é—´åå†ç»§ç»­éå†ã€‚</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">performUnitOfWork</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">workInProgress</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p><code>performUnitOfWork</code>æ–¹æ³•ä¼šåˆ›å»ºä¸‹ä¸€ä¸ª<code>FiberèŠ‚ç‚¹</code>å¹¶èµ‹å€¼ç»™<code>workInProgress</code>ï¼Œå¹¶å°†workInProgressä¸å·²åˆ›å»ºçš„FiberèŠ‚ç‚¹è¿æ¥èµ·æ¥æ„æˆFiberæ ‘ã€‚</p><p>Fiber Reconciler(åè°ƒå™¨)é€šè¿‡éå†çš„æ–¹å¼å®ç°å¯ä¸­æ–­çš„é€’å½’ï¼Œæ‰€ä»¥<code>performUnitOfWork</code>çš„å·¥ä½œå¯ä»¥åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š<code>â€œé€’â€å’Œâ€œå½’â€</code>ã€‚</p><h3 id="é€’-é˜¶æ®µ-beginwork" tabindex="-1">â€œé€’â€é˜¶æ®µ -- beginWork <a class="header-anchor" href="#é€’-é˜¶æ®µ-beginwork" aria-label="Permalink to &quot;â€œé€’â€é˜¶æ®µ -- beginWork&quot;">â€‹</a></h3><ul><li>é¦–å…ˆä»<code>rootFiber</code>å¼€å§‹å‘ä¸‹<strong>æ·±åº¦</strong>ä¼˜å…ˆéå†ã€‚ä¸ºéå†åˆ°çš„æ¯ä¸ªFiberèŠ‚ç‚¹è°ƒç”¨<code>beginWorkæ–¹æ³•</code>ã€‚ğŸ‘ -- è¯¥æ–¹æ³•ä¼šæ ¹æ®ä¼ å…¥çš„FiberèŠ‚ç‚¹åˆ›å»ºå­FiberèŠ‚ç‚¹ï¼Œå¹¶å°†è¿™ä¸¤ä¸ªFiberèŠ‚ç‚¹è¿æ¥èµ·æ¥ã€‚</li><li>å½“éå†åˆ°å¶å­èŠ‚ç‚¹ï¼ˆå³æ²¡æœ‰å­ç»„ä»¶çš„ç»„ä»¶ï¼‰æ—¶å°±ä¼šè¿›å…¥â€œå½’â€é˜¶æ®µã€‚</li></ul><h3 id="å½’-é˜¶æ®µ-completework" tabindex="-1">â€œå½’â€é˜¶æ®µ -- completeWork <a class="header-anchor" href="#å½’-é˜¶æ®µ-completework" aria-label="Permalink to &quot;â€œå½’â€é˜¶æ®µ -- completeWork&quot;">â€‹</a></h3><ul><li>åœ¨â€œå½’â€é˜¶æ®µä¼šè°ƒç”¨<code>completeWork</code>å¤„ç†FiberèŠ‚ç‚¹ã€‚ğŸ‘</li><li>å½“æŸä¸ªFiberèŠ‚ç‚¹æ‰§è¡Œå®ŒcompleteWorkï¼Œå¦‚æœå…¶å­˜åœ¨å…„å¼ŸFiberèŠ‚ç‚¹ï¼ˆå³fiber.sibling !== nullï¼‰ï¼Œä¼šè¿›å…¥å…¶<code>å…„å¼ŸFiber</code>çš„<code>é€’</code>é˜¶æ®µã€‚</li><li>å¦‚æœä¸å­˜åœ¨å…„å¼ŸFiberï¼Œä¼šè¿›å…¥<code>çˆ¶çº§Fiber</code>çš„<code>å½’</code>é˜¶æ®µã€‚</li><li><code>é€’</code>å’Œ<code>å½’</code>é˜¶æ®µä¼šäº¤é”™æ‰§è¡Œç›´åˆ°â€œå½’â€åˆ°rootFiberã€‚è‡³æ­¤ï¼Œrenderé˜¶æ®µçš„å·¥ä½œå°±ç»“æŸäº†ã€‚</li></ul><h3 id="ä¾‹å­" tabindex="-1">ä¾‹å­ <a class="header-anchor" href="#ä¾‹å­" aria-label="Permalink to &quot;ä¾‹å­&quot;">â€‹</a></h3><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">App</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> (</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">      i am</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">span</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">KaSong</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">span</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#F07178;">  )</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">ReactDOM</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">render</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">App</span><span style="color:#89DDFF;"> /&gt;,</span><span style="color:#A6ACCD;"> document</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getElementById</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">root</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">))</span><span style="color:#89DDFF;">;</span></span></code></pre></div><img src="`+l+`" width="60%/"><p>åœ¨<code>render</code>é˜¶æ®µä¼šä¾æ¬¡æ‰§è¡Œï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">1.</span><span style="color:#A6ACCD;"> rootFiber beginWork</span></span>
<span class="line"><span style="color:#F78C6C;">2.</span><span style="color:#A6ACCD;"> App Fiber beginWork</span></span>
<span class="line"><span style="color:#F78C6C;">3.</span><span style="color:#A6ACCD;"> div Fiber beginWork</span></span>
<span class="line"><span style="color:#F78C6C;">4.</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">i am</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> Fiber beginWork</span></span>
<span class="line"><span style="color:#F78C6C;">5.</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">i am</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> Fiber completeWork</span></span>
<span class="line"><span style="color:#F78C6C;">6.</span><span style="color:#A6ACCD;"> span Fiber beginWork</span></span>
<span class="line"><span style="color:#F78C6C;">7.</span><span style="color:#A6ACCD;"> span Fiber completeWork</span></span>
<span class="line"><span style="color:#F78C6C;">8.</span><span style="color:#A6ACCD;"> div Fiber completeWork</span></span>
<span class="line"><span style="color:#F78C6C;">9.</span><span style="color:#A6ACCD;"> App Fiber completeWork</span></span>
<span class="line"><span style="color:#F78C6C;">10.</span><span style="color:#A6ACCD;"> rootFiber completeWork</span></span></code></pre></div><h2 id="é€’-é˜¶æ®µ-beginwork-1" tabindex="-1">â€œé€’â€é˜¶æ®µ - beginWork <a class="header-anchor" href="#é€’-é˜¶æ®µ-beginwork-1" aria-label="Permalink to &quot;â€œé€’â€é˜¶æ®µ - beginWork&quot;">â€‹</a></h2><p><a href="https://github.com/facebook/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react-reconciler/src/ReactFiberBeginWork.new.js#L3075" target="_blank" rel="noreferrer">æºç åœ¨æ­¤</a></p><p><code>beginWork</code>çš„å·¥ä½œæ˜¯ä¼ å…¥<code>å½“å‰Fiber</code>èŠ‚ç‚¹ï¼Œæ ¹æ®<code>fiber.tag</code>æ¥åˆ›å»ºå…¶<code>å­Fiber</code>èŠ‚ç‚¹ã€‚å¹¶ä¸ºFiberèŠ‚ç‚¹å¸¦ä¸Š<code>effectTag</code>å±æ€§ã€‚</p><p>beginWorkçš„å·¥ä½œå¯ä»¥åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š</p><ul><li><strong>updateæ—¶</strong>ï¼šå¦‚æœ<code>current</code>å­˜åœ¨ï¼Œåœ¨<strong>æ»¡è¶³ä¸€å®šæ¡ä»¶æ—¶å¯ä»¥å¤ç”¨currentèŠ‚ç‚¹</strong>ï¼Œè¿™æ ·å°±èƒ½å…‹éš†current.childä½œä¸ºworkInProgress.childï¼Œè€Œä¸éœ€è¦æ–°å»ºworkInProgress.childã€‚</li><li><strong>mountæ—¶</strong>ï¼šé™¤<code>fiberRootNode</code>ä»¥å¤–ï¼Œcurrent === nullã€‚ä¼šæ ¹æ®<code>fiber.tagï¼ˆç»„ä»¶ç±»å‹ï¼Œç±»ç»„ä»¶ã€å‡½æ•°ç»„ä»¶...ï¼‰</code>ä¸åŒï¼Œè¿›å…¥ä¸åŒç±»å‹Fiberçš„åˆ›å»ºé€»è¾‘ã€‚æ ¹æ®ä¸åŒçš„tagï¼Œæ¥åˆ›å»ºå½“å‰fiberèŠ‚ç‚¹çš„ç¬¬ä¸€ä¸ª<code>å­FiberèŠ‚ç‚¹</code>ã€‚</li></ul><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">beginWork</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#A6ACCD;font-style:italic;">current</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Fiber</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">null</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">//å½“å‰ç»„ä»¶å¯¹åº”çš„FiberèŠ‚ç‚¹åœ¨ä¸Šä¸€æ¬¡æ›´æ–°æ—¶çš„FiberèŠ‚ç‚¹ï¼Œå³workInProgress.alternate</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#A6ACCD;font-style:italic;">workInProgress</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Fiber</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// å½“å‰ç»„ä»¶å¯¹åº”çš„FiberèŠ‚ç‚¹</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#A6ACCD;font-style:italic;">renderLanes</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Lanes</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// ä¼˜å…ˆçº§ç›¸å…³</span></span>
<span class="line"><span style="color:#89DDFF;">):</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Fiber</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">null</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// updateæ—¶ï¼šå¦‚æœcurrentå­˜åœ¨å¯èƒ½å­˜åœ¨ä¼˜åŒ–è·¯å¾„ï¼Œå¯ä»¥å¤ç”¨currentï¼ˆå³ä¸Šä¸€æ¬¡æ›´æ–°çš„FiberèŠ‚ç‚¹ï¼‰</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">current</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!==</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// ...çœç•¥</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// å¤ç”¨current</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">bailoutOnAlreadyFinishedWork</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">current</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">workInProgress</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">renderLanes</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    )</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">didReceiveUpdate</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// mountæ—¶ï¼šæ ¹æ®tagä¸åŒï¼Œåˆ›å»ºä¸åŒçš„å­FiberèŠ‚ç‚¹</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">switch</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">workInProgress</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">tag</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">IndeterminateComponent</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// ...çœç•¥</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">LazyComponent</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// ...çœç•¥</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">FunctionComponent</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// ...çœç•¥</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ClassComponent</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// ...çœç•¥</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">HostRoot</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// ...çœç•¥</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">HostComponent</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// ...çœç•¥</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">HostText</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// ...çœç•¥</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// ...çœç•¥å…¶ä»–ç±»å‹</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>å¯¹äºæˆ‘ä»¬å¸¸è§çš„ç»„ä»¶ç±»å‹ï¼Œå¦‚ï¼ˆFunctionComponent/ClassComponent/HostComponentï¼‰ï¼Œæœ€ç»ˆä¼šè¿›å…¥<code>reconcileChildren</code>æ–¹æ³•ã€‚</p><h3 id="reconcilechildren" tabindex="-1">reconcileChildren <a class="header-anchor" href="#reconcilechildren" aria-label="Permalink to &quot;reconcileChildren&quot;">â€‹</a></h3><p>é€šè¿‡current === null åŒºåˆ†mountä¸update</p><ul><li>å¯¹äº<strong>mount</strong>çš„ç»„ä»¶ï¼Œä»–ä¼šåˆ›å»ºæ–°çš„<code>å­FiberèŠ‚ç‚¹</code>ã€‚è°ƒç”¨<code>mountChildFibers</code>æ–¹æ³•</li><li>å¯¹äº<strong>update</strong>çš„ç»„ä»¶ï¼Œä»–ä¼šå°†å½“å‰ç»„ä»¶ä¸è¯¥ç»„ä»¶åœ¨ä¸Šæ¬¡æ›´æ–°æ—¶å¯¹åº”çš„FiberèŠ‚ç‚¹æ¯”è¾ƒï¼ˆä¹Ÿå°±<strong>Diff</strong>ç®—æ³•â— ï¼Œè¯¦è§ <strong>ã€ŠReactæ ¸å¿ƒåŸç†2-diffã€‹</strong>ï¼Œå°†æ¯”è¾ƒçš„ç»“æœç”Ÿæˆæ–°Fiberç‚¹ã€‚è°ƒç”¨<code>reconcileChildFibers</code>æ–¹æ³•ï¼Œä¼šä¸ºFiberèŠ‚ç‚¹å¸¦ä¸Š<code>effectTag</code>å±æ€§ã€‚</li></ul><p>ä¸è®ºèµ°å“ªä¸ªé€»è¾‘ï¼Œæœ€ç»ˆä»–ä¼šç”Ÿæˆ<code>æ–°çš„å­FiberèŠ‚ç‚¹</code>å¹¶èµ‹å€¼ç»™<code>workInProgress.child</code>ï¼Œä½œä¸ºæœ¬<code>beginWork</code>è¿”å›å€¼ï¼Œå¹¶ä½œä¸ºä¸‹æ¬¡<code>performUnitOfWork</code>æ‰§è¡Œæ—¶<code>workInProgress</code>çš„ä¼ å‚ã€‚</p><h3 id="effecttag" tabindex="-1">effectTag <a class="header-anchor" href="#effecttag" aria-label="Permalink to &quot;effectTag&quot;">â€‹</a></h3><p>å®ƒè¡¨ç¤ºï¼ŒRenderé˜¶æ®µç»“æŸåï¼Œé€šçŸ¥Renderï¼ˆæ¸²æŸ“å™¨ï¼‰è¦æ‰§è¡Œçš„DOMæ“ä½œç±»å‹ã€‚ä¿å­˜åœ¨<code>fiber.effectTag</code>ä¸Šã€‚</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// DOMéœ€è¦æ’å…¥åˆ°é¡µé¢ä¸­</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> Placement </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">/*                */</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0b00000000000010</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// DOMéœ€è¦æ›´æ–°</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> Update </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">/*                   */</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0b00000000000100</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// DOMéœ€è¦æ’å…¥åˆ°é¡µé¢ä¸­å¹¶æ›´æ–°</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> PlacementAndUpdate </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">/*       */</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0b00000000000110</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// DOMéœ€è¦åˆ é™¤</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> Deletion </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">/*                 */</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0b0000000000100</span></span>
<span class="line"><span style="color:#89DDFF;">...</span></span></code></pre></div><h3 id="æ€»ç»“" tabindex="-1">æ€»ç»“ <a class="header-anchor" href="#æ€»ç»“" aria-label="Permalink to &quot;æ€»ç»“&quot;">â€‹</a></h3><p><code>beginWork</code>çš„å·¥ä½œæ˜¯ä¼ å…¥<code>å½“å‰Fiber</code>èŠ‚ç‚¹ï¼Œæ ¹æ®<code>fiber.tag</code>æ¥åˆ›å»ºå…¶<code>å­Fiber</code>èŠ‚ç‚¹ã€‚å¹¶ä¸ºFiberèŠ‚ç‚¹å¸¦ä¸Š<code>effectTag</code>å±æ€§ã€‚</p><img src="`+p+`"><h2 id="å½’-é˜¶æ®µ-completework-1" tabindex="-1">&quot;å½’&quot;é˜¶æ®µ - completeWork <a class="header-anchor" href="#å½’-é˜¶æ®µ-completework-1" aria-label="Permalink to &quot;&quot;å½’&quot;é˜¶æ®µ - completeWork&quot;">â€‹</a></h2><p><code>completeWork</code>ä¹Ÿæ˜¯é’ˆå¯¹ä¸åŒ<code>fiber.tag(ç»„ä»¶ç±»å‹ï¼Œç±»ç»„ä»¶ã€å‡½æ•°ç»„ä»¶...ï¼‰</code>è°ƒç”¨ä¸åŒçš„å¤„ç†é€»è¾‘ã€‚</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">completeWork</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#A6ACCD;font-style:italic;">current</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Fiber</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">null</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#A6ACCD;font-style:italic;">workInProgress</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Fiber</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#A6ACCD;font-style:italic;">renderLanes</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Lanes</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">):</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Fiber</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">null</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">newProps</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">workInProgress</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">pendingProps</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">switch</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">workInProgress</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">tag</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">IndeterminateComponent</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">LazyComponent</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">SimpleMemoComponent</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">FunctionComponent</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ForwardRef</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Fragment</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Mode</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Profiler</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ContextConsumer</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">MemoComponent</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ClassComponent</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// ...çœç•¥</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">HostRoot</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// ...çœç•¥</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#82AAFF;">updateHostContainer</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">workInProgress</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">HostComponent</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// ...çœç•¥</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// ...çœç•¥</span></span></code></pre></div><h3 id="hostcomponenå¦‚ä½•å¤„ç†" tabindex="-1">HostComponenå¦‚ä½•å¤„ç† <a class="header-anchor" href="#hostcomponenå¦‚ä½•å¤„ç†" aria-label="Permalink to &quot;HostComponenå¦‚ä½•å¤„ç†&quot;">â€‹</a></h3><p>æˆ‘ä»¬é‡ç‚¹å…³æ³¨é¡µé¢æ¸²æŸ“æ‰€å¿…é¡»çš„<code>HostComponent</code>ï¼ˆå³åŸç”ŸDOMç»„ä»¶å¯¹åº”çš„FiberèŠ‚ç‚¹ï¼‰</p><p>å’Œ<code>beginWork</code>ä¸€æ ·ï¼Œæ ¹æ®<code>current === null ?</code>åˆ¤æ–­æ˜¯<code>mount</code>è¿˜æ˜¯<code>update</code>ã€‚</p><ul><li><p><code>update</code>æ—¶ï¼šFiberèŠ‚ç‚¹å·²ç»å­˜åœ¨å¯¹åº”<code>DOMèŠ‚ç‚¹</code>ï¼Œæ‰€ä»¥ä¸éœ€è¦ç”ŸæˆDOMèŠ‚ç‚¹ã€‚ä¸»è¦å·¥ä½œæ˜¯<code>updateHostComponent</code>è°ƒç”¨å¤„ç†<code>props</code>ï¼Œæ¯”å¦‚ï¼š</p><ul><li>onClickã€onChangeç­‰å›è°ƒå‡½æ•°çš„æ³¨å†Œ</li><li>å¤„ç†style prop</li><li>å¤„ç†DANGEROUSLY_SET_INNER_HTML prop</li><li>å¤„ç†children prop</li></ul><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> (current </span><span style="color:#89DDFF;">!==</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">null</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> workInProgress</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">stateNode </span><span style="color:#89DDFF;">!=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">null</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// updateçš„æƒ…å†µ</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">updateHostComponent</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">current</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">workInProgress</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">type</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">newProps</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">rootContainerInstance</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  )</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>åœ¨<code>updateHostComponent</code>å†…éƒ¨ï¼Œè¢«å¤„ç†å®Œçš„propsä¼šè¢«èµ‹å€¼ç»™<code>workInProgress.updateQueue</code>ï¼Œå¹¶æœ€ç»ˆä¼šåœ¨<code>commité˜¶æ®µ</code>è¢«æ¸²æŸ“åœ¨é¡µé¢ä¸Šã€‚</p></li><li><p><code>mount</code>æ—¶ï¼šä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ä¸ªé€»è¾‘</p><ul><li>ä¸ºFiberèŠ‚ç‚¹ç”Ÿæˆå¯¹åº”çš„<code>DOMèŠ‚ç‚¹</code></li><li>å°†å­å­™DOMèŠ‚ç‚¹æ’å…¥åˆšç”Ÿæˆçš„DOMèŠ‚ç‚¹ä¸­</li><li>ä¸updateé€»è¾‘ä¸­çš„<code>updateHostComponent</code>ç±»ä¼¼çš„å¤„ç†propsçš„è¿‡ç¨‹</li></ul></li></ul><h3 id="effectlist" tabindex="-1"><code>effectList</code> <a class="header-anchor" href="#effectlist" aria-label="Permalink to &quot;\`effectList\`&quot;">â€‹</a></h3><blockquote><p><code>effectTag</code>è¡¨ç¤º<code>Fiber</code>èŠ‚ç‚¹åœ¨<code>commité˜¶æ®µ</code>è¦æ‰§è¡Œçš„<strong>Domæ“ä½œ</strong>ã€‚</p></blockquote><p>ä½œä¸ºDOMæ“ä½œçš„ä¾æ®ï¼Œcommité˜¶æ®µéœ€è¦æ‰¾åˆ°æ‰€æœ‰æœ‰effectTagçš„FiberèŠ‚ç‚¹å¹¶ä¾æ¬¡æ‰§è¡ŒeffectTagå¯¹åº”æ“ä½œã€‚éš¾é“éœ€è¦åœ¨commité˜¶æ®µå†<strong>éå†</strong>ä¸€æ¬¡Fiberæ ‘å¯»æ‰¾effectTag !== nullçš„FiberèŠ‚ç‚¹ä¹ˆï¼Ÿ</p><p>è¿™æ˜¾ç„¶æ˜¯å¾ˆä½æ•ˆçš„ã€‚</p><p>ä¸ºäº†<strong>é«˜æ•ˆ</strong>çš„æ‰¾åˆ°æœ‰effectTagçš„èŠ‚ç‚¹ï¼Œåœ¨completeWorkçš„ä¸Šå±‚å‡½æ•°<code>completeUnitOfWork</code>ä¸­ï¼Œæ¯ä¸ªæ‰§è¡Œå®ŒcompleteWorkä¸”å­˜åœ¨<code>effectTag</code>çš„FiberèŠ‚ç‚¹ä¼šè¢«ä¿å­˜åœ¨ä¸€æ¡è¢«ç§°ä¸º<code>effectList</code>çš„<strong>å•å‘é“¾è¡¨</strong>ä¸­ã€‚æœ€ç»ˆå½¢æˆä¸€æ¡ä»¥rootFiber.firstEffectä¸ºèµ·ç‚¹çš„å•å‘é“¾è¡¨ã€‚</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">nextEffect         nextEffect</span></span>
<span class="line"><span style="color:#A6ACCD;">rootFiber</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">firstEffect </span><span style="color:#89DDFF;">-----------&gt;</span><span style="color:#A6ACCD;"> fiber </span><span style="color:#89DDFF;">-----------&gt;</span><span style="color:#A6ACCD;"> fiber</span></span></code></pre></div><p>è¿™æ ·ï¼Œåœ¨<code>commité˜¶æ®µ</code>åªéœ€è¦éå†<code>effectList</code>å°±èƒ½æ‰§è¡Œæ‰€æœ‰<code>effect</code>äº†ã€‚</p><h3 id="æ€»ç»“-1" tabindex="-1">æ€»ç»“ <a class="header-anchor" href="#æ€»ç»“-1" aria-label="Permalink to &quot;æ€»ç»“&quot;">â€‹</a></h3><p>completeWorkçš„ç›®çš„å°±æ˜¯ä¸ºäº†<code>åˆ›å»ºå¯¹åº”çš„domèŠ‚ç‚¹</code>æ’å…¥å¯¹åº”çš„<code>çˆ¶çº§èŠ‚ç‚¹</code>çš„domèŠ‚ç‚¹, ä¸ºå…¶æ·»åŠ <code>å‰¯ä½œç”¨</code>æ ‡è¯†ã€‚</p><img src="`+t+`"><h1 id="commité˜¶æ®µ" tabindex="-1">commité˜¶æ®µ <a class="header-anchor" href="#commité˜¶æ®µ" aria-label="Permalink to &quot;commité˜¶æ®µ&quot;">â€‹</a></h1><p>åœ¨<code>rootFiber.firstEffect</code>ä¸Šä¿å­˜äº†ä¸€æ¡<code>éœ€è¦æ‰§è¡Œå‰¯ä½œç”¨</code>çš„FiberèŠ‚ç‚¹çš„å•å‘é“¾è¡¨effectListï¼Œè¿™äº›FiberèŠ‚ç‚¹çš„<code>updateQueue</code>ä¸­ä¿å­˜äº†å˜åŒ–çš„propsã€‚</p><p>ä¸€äº›<code>å‰¯ä½œç”¨</code>å¯¹åº”çš„DOMæ“ä½œã€ä¸€äº›ç”Ÿå‘½å‘¨æœŸé’©å­ï¼ˆcomponentDidXXXï¼‰ã€æŸäº›hookï¼ˆuseEffectï¼‰éƒ½åœ¨commité˜¶æ®µæ‰§è¡Œ</p><p>commité˜¶æ®µçš„ä¸»è¦å·¥ä½œï¼ˆå³Rendererçš„å·¥ä½œæµç¨‹ï¼‰åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š</p><ul><li><code>before mutation</code>é˜¶æ®µï¼ˆæ‰§è¡ŒDOMæ“ä½œå‰ï¼‰</li><li><code>mutation</code>é˜¶æ®µï¼ˆæ‰§è¡ŒDOMæ“ä½œï¼‰</li><li><code>layout</code>é˜¶æ®µï¼ˆæ‰§è¡ŒDOMæ“ä½œåï¼‰</li></ul><p>å¦å¤–ï¼Œ</p><ul><li>åœ¨before mutationä¹‹å‰ï¼šä¸»è¦åšä¸€äº›å˜é‡èµ‹å€¼ï¼ŒçŠ¶æ€é‡ç½®çš„å·¥ä½œã€‚</li><li>åœ¨layouté˜¶æ®µä¹‹åï¼š <ol><li>useEffectç›¸å…³å¤„ç†</li><li>æ€§èƒ½è¿½è¸ªç›¸å…³</li><li>æ‰§è¡ŒåŒæ­¥ä»»åŠ¡, æ¯”å¦‚åœ¨ componentDidMount ä¸­æ‰§è¡Œ setState åˆ›å»ºçš„æ›´æ–°ä¼šåœ¨è¿™é‡Œè¢«åŒæ­¥æ‰§è¡Œ, useLayoutEffectã€useEffectçš„å›è°ƒæ–¹æ³•ä¹Ÿä¼šåœ¨è¿™é‡Œè¢«æ‰§è¡Œ</li></ol></li></ul><h2 id="before-mutationé˜¶æ®µ-æ‰§è¡Œdomæ“ä½œå‰" tabindex="-1">before mutationé˜¶æ®µï¼ˆæ‰§è¡ŒDOMæ“ä½œå‰ï¼‰ <a class="header-anchor" href="#before-mutationé˜¶æ®µ-æ‰§è¡Œdomæ“ä½œå‰" aria-label="Permalink to &quot;before mutationé˜¶æ®µï¼ˆæ‰§è¡ŒDOMæ“ä½œå‰ï¼‰&quot;">â€‹</a></h2><p>åœ¨before mutationé˜¶æ®µï¼Œä¼šéå†<code>effectList</code>ï¼ˆä¿å­˜effectTagçš„å•å‘é“¾è¡¨ï¼‰ï¼Œå¹¶è°ƒç”¨<code>commitBeforeMutationEffects</code>å‡½æ•°ï¼Œä¾æ¬¡æ‰§è¡Œï¼š</p><ol><li>å¤„ç†DOMèŠ‚ç‚¹æ¸²æŸ“/åˆ é™¤åçš„ autoFocusã€bluré€»è¾‘</li><li>è°ƒç”¨<code>getSnapshotBeforeUpdate</code>ç”Ÿå‘½å‘¨æœŸé’©å­ <blockquote><p>ä»Reactv16å¼€å§‹ï¼Œ<code>componentWillXXX</code>é’©å­å‰å¢åŠ äº†<code>UNSAFE_</code>å‰ç¼€ã€‚ä½†æä¾›äº†æ›¿ä»£çš„ç”Ÿå‘½å‘¨æœŸé’©å­ <code>getSnapshotBeforeUpdate</code>ã€‚</p></blockquote></li><li>è°ƒåº¦<code>useEffect</code><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">// è°ƒåº¦useEffect</span></span>
<span class="line"><span style="color:#A6ACCD;">if ((effectTag &amp; Passive) !== NoEffect) {</span></span>
<span class="line"><span style="color:#A6ACCD;">  if (!rootDoesHavePassiveEffects) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    rootDoesHavePassiveEffects = true;</span></span>
<span class="line"><span style="color:#A6ACCD;">    scheduleCallback(NormalSchedulerPriority, () =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">      // è§¦å‘useEffect</span></span>
<span class="line"><span style="color:#A6ACCD;">      flushPassiveEffects();</span></span>
<span class="line"><span style="color:#A6ACCD;">      return null;</span></span>
<span class="line"><span style="color:#A6ACCD;">    });</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span></code></pre></div><code>scheduleCallback</code>æ–¹æ³•ç”±<code>Scheduler</code>æ¨¡å—æä¾›ï¼Œç”¨äºä»¥æŸä¸ª<strong>ä¼˜å…ˆçº§å¼‚æ­¥è°ƒåº¦ä¸€ä¸ªå›è°ƒå‡½æ•°</strong>ã€‚å¼‚æ­¥è°ƒåº¦ä¸»è¦æ˜¯é˜²æ­¢åŒæ­¥æ‰§è¡Œæ—¶é˜»å¡æµè§ˆå™¨æ¸²æŸ“ã€‚</li></ol><h2 id="mutationé˜¶æ®µ-æ‰§è¡Œdomæ“ä½œ" tabindex="-1">mutationé˜¶æ®µï¼ˆæ‰§è¡ŒDOMæ“ä½œï¼‰ <a class="header-anchor" href="#mutationé˜¶æ®µ-æ‰§è¡Œdomæ“ä½œ" aria-label="Permalink to &quot;mutationé˜¶æ®µï¼ˆæ‰§è¡ŒDOMæ“ä½œï¼‰&quot;">â€‹</a></h2><p>mutationé˜¶æ®µä¼šéå† <code>effectList</code>ï¼Œä¾æ¬¡æ‰§è¡Œ<code>commitMutationEffects</code>ã€‚è¯¥æ–¹æ³•çš„ä¸»è¦å·¥ä½œä¸ºæ ¹æ®<code>effectTag</code>è°ƒç”¨ä¸åŒçš„å¤„ç†å‡½æ•°<code>å¤„ç†Fiber</code>ï¼Œæ‰§è¡ŒDOMæ“ä½œã€‚</p><p>å¯¹æ¯ä¸ª<code>Fiber</code>èŠ‚ç‚¹æ‰§è¡Œå¦‚ä¸‹ä¸‰ä¸ªæ“ä½œï¼š</p><ul><li>æ ¹æ®<code>ContentReset effectTag</code>é‡ç½®æ–‡å­—èŠ‚ç‚¹</li><li>æ›´æ–°<code>ref</code></li><li>æ ¹æ®<code>effectTag</code>åˆ†åˆ«å¤„ç†ï¼Œå…¶ä¸­effectTagåŒ…æ‹¬(<code>Placement</code> | <code>Update</code> | <code>Deletion</code> | <code>Hydrating</code>ç­‰)</li></ul><h3 id="placement-effect" tabindex="-1">Placement effect <a class="header-anchor" href="#placement-effect" aria-label="Permalink to &quot;Placement effect&quot;">â€‹</a></h3><p>å«æœ‰<code>Placement effectTag</code>ï¼Œæ„å‘³ç€è¯¥FiberèŠ‚ç‚¹å¯¹åº”çš„DOMèŠ‚ç‚¹éœ€è¦<strong>æ’å…¥</strong>åˆ°é¡µé¢ä¸­ã€‚è°ƒç”¨çš„æ–¹æ³•ä¸º<code>commitPlacement</code>ã€‚</p><p>è¯¥æ–¹æ³•æ‰€åšçš„å·¥ä½œåˆ†ä¸ºä¸‰æ­¥ï¼š</p><ol><li><p>è·å–çˆ¶çº§DOMèŠ‚ç‚¹ã€‚å…¶ä¸­finishedWorkä¸ºä¼ å…¥çš„FiberèŠ‚ç‚¹ã€‚</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> parentFiber </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">getHostParentFiber</span><span style="color:#A6ACCD;">(finishedWork)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// çˆ¶çº§DOMèŠ‚ç‚¹</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> parentStateNode </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> parentFiber</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">stateNode</span><span style="color:#89DDFF;">;</span></span></code></pre></div></li><li><p>è·å–FiberèŠ‚ç‚¹çš„DOMå…„å¼ŸèŠ‚ç‚¹</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> before </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">getHostSibling</span><span style="color:#A6ACCD;">(finishedWork)</span><span style="color:#89DDFF;">;</span></span></code></pre></div></li><li><p>æ ¹æ®DOMå…„å¼ŸèŠ‚ç‚¹æ˜¯å¦å­˜åœ¨å†³å®šè°ƒç”¨<code>parentNode.insertBefore</code>æˆ–<code>parentNode.appendChild</code>æ‰§è¡ŒDOMæ’å…¥æ“ä½œã€‚</p></li></ol><h3 id="update-effect" tabindex="-1">Update effect <a class="header-anchor" href="#update-effect" aria-label="Permalink to &quot;Update effect&quot;">â€‹</a></h3><p>å«æœ‰<code>Update effectTag</code>ï¼Œæ„å‘³ç€è¯¥FiberèŠ‚ç‚¹éœ€è¦<strong>æ›´æ–°</strong>ã€‚è°ƒç”¨çš„æ–¹æ³•ä¸º<code>commitWork</code>ï¼Œä»–ä¼šæ ¹æ®Fiber.tagåˆ†åˆ«å¤„ç†ã€‚</p><h3 id="deletion-effect" tabindex="-1">Deletion effect <a class="header-anchor" href="#deletion-effect" aria-label="Permalink to &quot;Deletion effect&quot;">â€‹</a></h3><p>å«æœ‰<code>Deletion effectTag</code>ï¼Œæ„å‘³ç€è¯¥FiberèŠ‚ç‚¹å¯¹åº”çš„DOMèŠ‚ç‚¹éœ€è¦ä»é¡µé¢ä¸­<strong>åˆ é™¤</strong>ã€‚è°ƒç”¨çš„æ–¹æ³•ä¸º<code>commitDeletion</code>ã€‚</p><p>è¯¥æ–¹æ³•ä¼šæ‰§è¡Œå¦‚ä¸‹æ“ä½œï¼š</p><ol><li>é€’å½’è°ƒç”¨<code>FiberèŠ‚ç‚¹</code>åŠå…¶å­å­™FiberèŠ‚ç‚¹ä¸­fiber.tagä¸º<code>ClassComponent</code>çš„<code>componentWillUnmount</code>ç”Ÿå‘½å‘¨æœŸé’©å­ï¼Œä»é¡µé¢<strong>ç§»é™¤</strong>FiberèŠ‚ç‚¹å¯¹åº”DOMèŠ‚ç‚¹</li><li>è§£ç»‘ref</li><li>è°ƒåº¦<code>useEffect</code>çš„é”€æ¯å‡½æ•°</li></ol><h2 id="layouté˜¶æ®µ-æ‰§è¡Œdomæ“ä½œå" tabindex="-1">layouté˜¶æ®µï¼ˆæ‰§è¡ŒDOMæ“ä½œåï¼‰ <a class="header-anchor" href="#layouté˜¶æ®µ-æ‰§è¡Œdomæ“ä½œå" aria-label="Permalink to &quot;layouté˜¶æ®µï¼ˆæ‰§è¡ŒDOMæ“ä½œåï¼‰&quot;">â€‹</a></h2><p>layouté˜¶æ®µä¹Ÿä¼šéå† <code>effectList</code>ï¼Œä¾æ¬¡æ‰§è¡Œ<code>commitLayoutEffects</code>ã€‚è¯¥æ–¹æ³•çš„ä¸»è¦å·¥ä½œä¸ºæ ¹æ®<code>effectTag</code>è°ƒç”¨ä¸åŒçš„å¤„ç†å‡½æ•°<code>å¤„ç†Fiber</code>å¹¶æ›´æ–°<code>ref</code>ã€‚</p><p><code>commitLayoutEffects</code>ä¸€å…±åšäº†ä¸¤ä»¶äº‹ï¼š</p><ol><li><code>commitLayoutEffectOnFiber</code>ï¼ˆè°ƒç”¨ç”Ÿå‘½å‘¨æœŸé’©å­å’Œhookç›¸å…³æ“ä½œï¼‰ <ul><li><p>å¯¹äº<code>ClassComponent</code>ï¼Œä»–ä¼šé€šè¿‡<code>current === null?</code>åŒºåˆ†æ˜¯<code>mount</code>è¿˜æ˜¯<code>update</code>ï¼Œè°ƒç”¨<code>componentDidMount</code>æˆ–<code>componentDidUpdate</code>ã€‚ è§¦å‘çŠ¶æ€æ›´æ–°çš„<code>this.setState</code>å¦‚æœèµ‹å€¼äº†<strong>ç¬¬äºŒä¸ªå‚æ•°å›è°ƒå‡½æ•°</strong>ï¼Œä¹Ÿä¼šåœ¨æ­¤æ—¶è°ƒç”¨ã€‚</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">setState</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">xxx</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">},</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">i am update~</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre></div></li><li><p>å¯¹äº<code>FunctionComponent</code>åŠ<code>ç›¸å…³ç±»å‹</code>ï¼Œä»–ä¼šè°ƒç”¨<code>useLayoutEffect hook</code>çš„å›è°ƒå‡½æ•°ï¼Œè°ƒåº¦<code>useEffect</code>çš„é”€æ¯ä¸å›è°ƒå‡½æ•°</p><blockquote><p><code>ç›¸å…³ç±»å‹</code>æŒ‡ç‰¹æ®Šå¤„ç†åçš„FunctionComponentï¼Œæ¯”å¦‚ForwardRefã€React.memoåŒ…è£¹çš„FunctionComponent</p></blockquote></li></ul></li><li><code>commitAttachRef</code>ï¼ˆèµ‹å€¼ refï¼‰: <strong>è·å–DOMå®ä¾‹ï¼Œæ›´æ–°ref</strong></li></ol><p>å¦å¤–ï¼Œåœ¨<code>layout</code>é˜¶æ®µï¼Œ<strong>workInProgress Fiberæ ‘åœ¨commité˜¶æ®µå®Œæˆæ¸²æŸ“åä¼šå˜ä¸ºcurrent Fiberæ ‘</strong>ã€‚</p>`,89),i=[r];function y(F,D,d,C,f,A){return n(),a("div",null,i)}const b=s(c,[["render",y]]);export{u as __pageData,b as default};
